import{d as x,o as B,N as M,P as N,c as r,a as t,r as u,e as v,F as C,f as F,h as j,H as T,j as y,t as a,u as D,R as S,G as U,i as q,k as o,_ as z}from"./index-BSxIWjy8.js";const E={class:"scans-page"},G={key:0,class:"loading"},H={key:1,class:"empty-state"},X={key:2,class:"section"},J={class:"data-table"},K={class:"project-cell"},O={key:1,class:"muted"},Q={class:"mono"},W=x({__name:"ScansView",setup(Y){const i=u([]),f=u(!0),k=u(1),I=u(0),d=u({}),p=u({}),h=u(Date.now());let c=null;async function L(){f.value=!0;try{const e=await j.listScans({page:k.value,pageSize:20});i.value=e.data.scans,I.value=e.data.total,await A(i.value)}catch(e){console.error("Failed to fetch scans",e)}finally{f.value=!1}}async function A(e){const s=Array.from(new Set(e.map(l=>l.projectId).filter(l=>typeof l=="string"&&l.length>0))).filter(l=>!d.value[l]&&!p.value[l]);if(s.length===0)return;(await Promise.allSettled(s.map(l=>j.getProject(l)))).forEach((l,V)=>{const _=s[V];l.status==="fulfilled"?d.value={...d.value,[_]:l.value.data}:p.value={...p.value,[_]:!0}})}function g(e){if(!e)return"-";const n=d.value[e];return n?n.name:p.value[e]?"Unknown project":"Loadingâ€¦"}function b(e){if(!Number.isFinite(e)||e<0)return"-";const n=Math.floor(e/1e3),s=Math.floor(n/60),m=Math.floor(s/60);return m>0?`${m}h ${s%60}m ${n%60}s`:s>0?`${s}m ${n%60}s`:`${n}s`}function P(e){if(!e.startedAt)return"-";const n=new Date(e.startedAt).getTime(),s=e.completedAt?new Date(e.completedAt).getTime():e.status==="scanning"?h.value:null;return s?b(s-n):"-"}function $(){c==null&&(c=window.setInterval(()=>{h.value=Date.now()},1e3))}function w(){c!=null&&(window.clearInterval(c),c=null)}function R(e){switch(e){case"complete":return"status-success";case"scanning":return"status-warning";case"failed":return"status-error";default:return"status-pending"}}return B(L),M(()=>i.value.some(e=>e.status==="scanning"&&!!e.startedAt&&!e.completedAt),e=>{e?$():w()},{immediate:!0}),N(()=>{w()}),(e,n)=>(o(),r("div",E,[n[4]||(n[4]=t("header",{class:"page-header"},[t("h1",null,"Scans"),t("p",{class:"subtitle"},"View all license scans across projects")],-1)),f.value?(o(),r("div",G,[...n[0]||(n[0]=[t("i",{class:"pi pi-spin pi-spinner"},null,-1),v(" Loading scans... ",-1)])])):i.value.length===0?(o(),r("div",H,[...n[1]||(n[1]=[t("i",{class:"pi pi-search"},null,-1),t("h3",null,"No scans yet",-1),t("p",null,"Go to a project and run your first scan.",-1)])])):(o(),r("div",X,[t("table",J,[n[3]||(n[3]=t("thead",null,[t("tr",null,[t("th",null,"Project"),t("th",null,"Status"),t("th",null,"Duration"),t("th",null,"Dependencies"),t("th",null,"Resolved"),t("th",null,"Unresolved"),t("th",null,"AI Resolved"),t("th",null,"SPDX Resolved"),t("th",null,"Completed"),t("th")])],-1)),t("tbody",null,[(o(!0),r(C,null,F(i.value,s=>(o(),r("tr",{key:s.id},[t("td",K,[s.projectId?(o(),T(D(S),{key:0,to:`/projects/${s.projectId}`,class:"project-link",title:g(s.projectId)},{default:y(()=>[v(a(g(s.projectId)),1)]),_:2},1032,["to","title"])):(o(),r("span",O,"-"))]),t("td",null,[t("span",{class:U(["status-badge",R(s.status)])},a(s.status),3)]),t("td",Q,a(P(s)),1),t("td",null,a(s.totalDependencies),1),t("td",null,a(s.resolvedLicenses),1),t("td",null,a(s.unresolvedLicenses),1),t("td",null,a(s.aiResolvedLicenses),1),t("td",null,a(s.spdxResolvedLicenses||0),1),t("td",null,a(s.completedAt?new Date(s.completedAt).toLocaleString():"-"),1),t("td",null,[q(D(S),{to:`/scans/${s.id}`,class:"btn btn-small"},{default:y(()=>[...n[2]||(n[2]=[v(" View Details ",-1)])]),_:1},8,["to"])])]))),128))])])]))]))}}),tt=z(W,[["__scopeId","data-v-37359ca9"]]);export{tt as default};
