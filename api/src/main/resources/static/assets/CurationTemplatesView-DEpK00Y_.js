import{d as ae,M as se,o as ie,c as d,a,i,u as s,r,e as oe,j as c,S as ne,h as w,b as z,t as C,F as _,f as k,H as N,k as u,_ as ue}from"./index-BSxIWjy8.js";import{a as p,c as de,d as h,s as re,e as $,b as U}from"./column.esm-Ytj2qQr1.js";import{s as H}from"./dialog.esm-CobFf9Md.js";import{s as pe}from"./textarea.esm-DSEO0_7R.js";import{s as ce}from"./inputswitch.esm-CbhghCDc.js";import"./virtualscroller.esm-K1aAPOwj.js";const ve={class:"templates-view"},me={class:"page-header"},fe={key:0,class:"loading"},ye={key:1,class:"section"},be={class:"template-name"},Te={key:0,class:"description"},Ce={class:"conditions-list"},he={class:"actions-list"},Ae={class:"usage-count"},Ve={class:"table-actions"},Ee={class:"editor-content"},ge={class:"form-section"},we={class:"form-row"},Se={class:"field flex-1"},_e={class:"field"},ke={class:"field"},Ue={class:"form-section"},Ie={class:"section-header"},De={class:"form-section"},xe={class:"section-header"},Le={class:"delete-content"},Ne=ae({__name:"CurationTemplatesView",setup($e){const v=se(),S=r([]),I=r(!0),y=r(!1),A=r(!1),V=r(null),b=r(null),T=r(""),E=r(""),g=r(!0),m=r([]),f=r([]),D=r(!1),M=[{label:"AI Confidence",value:"aiConfidence"},{label:"AI Suggested License",value:"aiSuggestedLicense"},{label:"Original License",value:"originalLicense"},{label:"Dependency Name",value:"dependencyName"},{label:"Scope",value:"scope"},{label:"Priority",value:"priority"}],F=[{label:"Equals",value:"EQUALS"},{label:"Not Equals",value:"NOT_EQUALS"},{label:"Contains",value:"CONTAINS"},{label:"Starts With",value:"STARTS_WITH"},{label:"Ends With",value:"ENDS_WITH"},{label:"Matches Pattern",value:"MATCHES"},{label:"Is Empty",value:"IS_EMPTY"},{label:"Is Not Empty",value:"IS_NOT_EMPTY"}],O=[{label:"Set Status",value:"SET_STATUS"},{label:"Set License",value:"SET_LICENSE"},{label:"Add Comment",value:"ADD_COMMENT"},{label:"Set Priority",value:"SET_PRIORITY"}],Y=[{label:"Accept",value:"ACCEPTED"},{label:"Reject",value:"REJECTED"},{label:"Modify",value:"MODIFIED"}],B=[{label:"High",value:"HIGH"},{label:"Medium",value:"MEDIUM"},{label:"Low",value:"LOW"}],x=ne(()=>V.value!==null);async function P(){I.value=!0;try{const l=await w.listTemplates();S.value=l.data.templates}catch(l){console.error("Failed to fetch templates",l),v.add({severity:"error",summary:"Error",detail:"Failed to load templates",life:3e3})}finally{I.value=!1}}function W(){V.value=null,T.value="",E.value="",g.value=!0,m.value=[{field:"aiConfidence",operator:"EQUALS",value:""}],f.value=[{type:"SET_STATUS",value:"ACCEPTED"}],y.value=!0}function Q(l){V.value=l,T.value=l.name,E.value=l.description||"",g.value=l.isActive,m.value=[...l.conditions],f.value=[...l.actions],y.value=!0}function q(){m.value.push({field:"aiConfidence",operator:"EQUALS",value:""})}function j(l){m.value.splice(l,1)}function G(){f.value.push({type:"SET_STATUS",value:"ACCEPTED"})}function J(l){f.value.splice(l,1)}function R(l){switch(l){case"SET_STATUS":return Y;case"SET_PRIORITY":return B;default:return null}}async function K(){if(!T.value||m.value.length===0||f.value.length===0){v.add({severity:"warn",summary:"Validation",detail:"Please fill in all required fields",life:3e3});return}D.value=!0;try{const l={name:T.value,description:E.value||null,conditions:m.value,actions:f.value,isActive:g.value};x.value&&V.value?(await w.updateTemplate(V.value.id,l),v.add({severity:"success",summary:"Success",detail:"Template updated",life:2e3})):(await w.createTemplate(l),v.add({severity:"success",summary:"Success",detail:"Template created",life:2e3})),await P(),y.value=!1}catch(l){console.error("Failed to save template",l),v.add({severity:"error",summary:"Error",detail:"Failed to save template",life:3e3})}finally{D.value=!1}}function X(l){b.value=l,A.value=!0}async function Z(){if(b.value)try{await w.deleteTemplate(b.value.id),S.value=S.value.filter(l=>l.id!==b.value.id),A.value=!1,b.value=null,v.add({severity:"success",summary:"Success",detail:"Template deleted",life:2e3})}catch(l){console.error("Failed to delete template",l),v.add({severity:"error",summary:"Error",detail:"Failed to delete template",life:3e3})}}async function ee(l){try{await w.updateTemplate(l.id,{isActive:!l.isActive}),l.isActive=!l.isActive}catch(t){console.error("Failed to toggle template",t),v.add({severity:"error",summary:"Error",detail:"Failed to update template",life:3e3})}}function le(l){var n,o;const t=((n=M.find(L=>L.value===l.field))==null?void 0:n.label)||l.field,e=((o=F.find(L=>L.value===l.operator))==null?void 0:o.label)||l.operator;return`${t} ${e.toLowerCase()} "${l.value}"`}function te(l){var e;return`${((e=O.find(n=>n.value===l.type))==null?void 0:e.label)||l.type}: ${l.value}`}return ie(P),(l,t)=>(u(),d("div",ve,[a("header",me,[t[7]||(t[7]=a("div",null,[a("h1",null,"Curation Templates"),a("p",{class:"subtitle"},"Automate curation decisions with reusable templates")],-1)),i(s(p),{label:"Create Template",icon:"pi pi-plus",onClick:W})]),I.value?(u(),d("div",fe,[...t[8]||(t[8]=[a("i",{class:"pi pi-spin pi-spinner"},null,-1),oe(" Loading templates... ",-1)])])):(u(),d("div",ye,[i(s(de),{value:S.value,stripedRows:"",showGridlines:"",class:"p-datatable-sm",emptyMessage:"No templates yet. Create one to automate curation decisions."},{default:c(()=>[i(s(h),{field:"name",header:"Name",style:{"min-width":"200px"},sortable:""},{body:c(({data:e})=>[a("div",be,[a("strong",null,C(e.name),1),e.description?(u(),d("span",Te,C(e.description),1)):z("",!0)])]),_:1}),i(s(h),{header:"Conditions",style:{"min-width":"250px"}},{body:c(({data:e})=>[a("div",Ce,[(u(!0),d(_,null,k(e.conditions,(n,o)=>(u(),d("span",{key:o,class:"condition-badge"},C(le(n)),1))),128))])]),_:1}),i(s(h),{header:"Actions",style:{"min-width":"200px"}},{body:c(({data:e})=>[a("div",he,[(u(!0),d(_,null,k(e.actions,(n,o)=>(u(),d("span",{key:o,class:"action-badge"},C(te(n)),1))),128))])]),_:1}),i(s(h),{field:"isActive",header:"Status",style:{width:"100px"}},{body:c(({data:e})=>[i(s(re),{value:e.isActive?"Active":"Inactive",severity:e.isActive?"success":"secondary"},null,8,["value","severity"])]),_:1}),i(s(h),{field:"usageCount",header:"Usage",style:{width:"80px"},sortable:""},{body:c(({data:e})=>[a("span",Ae,C(e.usageCount),1)]),_:1}),i(s(h),{header:"Actions",style:{width:"150px"}},{body:c(({data:e})=>[a("div",Ve,[i(s(p),{icon:"pi pi-pencil",severity:"secondary",text:"",rounded:"",size:"small",onClick:n=>Q(e),title:"Edit"},null,8,["onClick"]),i(s(p),{icon:e.isActive?"pi pi-pause":"pi pi-play",severity:"secondary",text:"",rounded:"",size:"small",onClick:n=>ee(e),title:e.isActive?"Deactivate":"Activate"},null,8,["icon","onClick","title"]),i(s(p),{icon:"pi pi-trash",severity:"danger",text:"",rounded:"",size:"small",onClick:n=>X(e),title:"Delete"},null,8,["onClick"])])]),_:1})]),_:1},8,["value"])])),i(s(H),{visible:y.value,"onUpdate:visible":t[4]||(t[4]=e=>y.value=e),header:x.value?"Edit Template":"Create Template",modal:!0,style:{width:"800px"}},{footer:c(()=>[i(s(p),{label:"Cancel",severity:"secondary",onClick:t[3]||(t[3]=e=>y.value=!1)}),i(s(p),{label:x.value?"Update Template":"Create Template",icon:"pi pi-check",onClick:K,loading:D.value},null,8,["label","loading"])]),default:c(()=>[a("div",Ee,[a("div",ge,[t[12]||(t[12]=a("h4",null,"Basic Information",-1)),a("div",we,[a("div",Se,[t[9]||(t[9]=a("label",null,"Name *",-1)),i(s($),{modelValue:T.value,"onUpdate:modelValue":t[0]||(t[0]=e=>T.value=e),placeholder:"Template name...",class:"w-full"},null,8,["modelValue"])]),a("div",_e,[t[10]||(t[10]=a("label",null,"Active",-1)),i(s(ce),{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=e=>g.value=e)},null,8,["modelValue"])])]),a("div",ke,[t[11]||(t[11]=a("label",null,"Description",-1)),i(s(pe),{modelValue:E.value,"onUpdate:modelValue":t[2]||(t[2]=e=>E.value=e),rows:"2",class:"w-full",placeholder:"Describe what this template does..."},null,8,["modelValue"])])]),a("div",Ue,[a("div",Ie,[t[13]||(t[13]=a("h4",null,"Conditions",-1)),i(s(p),{label:"Add Condition",icon:"pi pi-plus",severity:"secondary",size:"small",onClick:q})]),t[14]||(t[14]=a("p",{class:"help-text"},"Items must match ALL conditions to trigger this template.",-1)),(u(!0),d(_,null,k(m.value,(e,n)=>(u(),d("div",{key:n,class:"condition-row"},[i(s(U),{modelValue:e.field,"onUpdate:modelValue":o=>e.field=o,options:M,optionLabel:"label",optionValue:"value",placeholder:"Field",class:"field-dropdown"},null,8,["modelValue","onUpdate:modelValue"]),i(s(U),{modelValue:e.operator,"onUpdate:modelValue":o=>e.operator=o,options:F,optionLabel:"label",optionValue:"value",placeholder:"Operator",class:"operator-dropdown"},null,8,["modelValue","onUpdate:modelValue"]),["IS_EMPTY","IS_NOT_EMPTY"].includes(e.operator)?z("",!0):(u(),N(s($),{key:0,modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,placeholder:"Value...",class:"value-input"},null,8,["modelValue","onUpdate:modelValue"])),i(s(p),{icon:"pi pi-times",severity:"danger",text:"",rounded:"",size:"small",onClick:o=>j(n),disabled:m.value.length===1},null,8,["onClick","disabled"])]))),128))]),a("div",De,[a("div",xe,[t[15]||(t[15]=a("h4",null,"Actions",-1)),i(s(p),{label:"Add Action",icon:"pi pi-plus",severity:"secondary",size:"small",onClick:G})]),t[16]||(t[16]=a("p",{class:"help-text"},"Actions to apply when conditions match.",-1)),(u(!0),d(_,null,k(f.value,(e,n)=>(u(),d("div",{key:n,class:"action-row"},[i(s(U),{modelValue:e.type,"onUpdate:modelValue":o=>e.type=o,options:O,optionLabel:"label",optionValue:"value",placeholder:"Action Type",class:"type-dropdown"},null,8,["modelValue","onUpdate:modelValue"]),R(e.type)?(u(),N(s(U),{key:0,modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,options:R(e.type),optionLabel:"label",optionValue:"value",placeholder:"Value",class:"value-dropdown"},null,8,["modelValue","onUpdate:modelValue","options"])):(u(),N(s($),{key:1,modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,placeholder:"Value...",class:"value-input"},null,8,["modelValue","onUpdate:modelValue"])),i(s(p),{icon:"pi pi-times",severity:"danger",text:"",rounded:"",size:"small",onClick:o=>J(n),disabled:f.value.length===1},null,8,["onClick","disabled"])]))),128))])])]),_:1},8,["visible","header"]),i(s(H),{visible:A.value,"onUpdate:visible":t[6]||(t[6]=e=>A.value=e),header:"Delete Template",modal:!0,style:{width:"400px"}},{footer:c(()=>[i(s(p),{label:"Cancel",severity:"secondary",onClick:t[5]||(t[5]=e=>A.value=!1)}),i(s(p),{label:"Delete",severity:"danger",icon:"pi pi-trash",onClick:Z})]),default:c(()=>{var e;return[a("div",Le,[t[17]||(t[17]=a("i",{class:"pi pi-exclamation-triangle warning-icon"},null,-1)),a("p",null,'Are you sure you want to delete the template "'+C((e=b.value)==null?void 0:e.name)+'"?',1),t[18]||(t[18]=a("p",{class:"warning-text"},"This action cannot be undone.",-1))])]}),_:1},8,["visible"])]))}}),He=ue(Ne,[["__scopeId","data-v-1ce32ce2"]]);export{He as default};
