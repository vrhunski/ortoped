import{d as P,M as V,o as N,c,a as t,i,S as E,r as f,u as l,e as y,F as L,b as C,t as o,j as n,h as k,R as F,X as M,k as u,_ as O}from"./index-BSxIWjy8.js";import{a as _,c as B,d as p,s as T,b as j}from"./column.esm-Ytj2qQr1.js";import{s as G}from"./dialog.esm-CobFf9Md.js";import{s as U}from"./progressbar.esm-BRvOJTo9.js";import"./virtualscroller.esm-K1aAPOwj.js";const z={class:"curations-view"},X={class:"page-header"},Y={key:0,class:"loading"},q={class:"summary-cards"},H={class:"card"},J={class:"card-value"},K={class:"card success"},Q={class:"card-value"},W={class:"card warning"},Z={class:"card-value"},ss={class:"card info"},es={class:"card-value"},ts={key:0,class:"section"},as={class:"scan-info"},ls={key:0,class:"scan-meta"},is={class:"progress-cell"},os={class:"progress-text"},ns={class:"decision-stats"},rs={class:"stat accepted",title:"Accepted"},ds={class:"stat rejected",title:"Rejected"},cs={class:"stat modified",title:"Modified"},us={key:0,class:"approval-info"},ps={class:"approval-date"},vs={key:1,class:"not-approved"},fs={class:"dialog-content"},ys={class:"field"},ms={key:0,class:"no-scans-message"},gs=P({__name:"CurationsView",setup(hs){const I=M(),b=V(),r=f([]),g=f([]),w=f(!0),m=f(!1),v=f(null),S=f(!1),h=E(()=>{const a=new Set(r.value.map(s=>s.scanId));return g.value.filter(s=>s.status==="complete"&&!a.has(s.id)).map(s=>({label:`${s.id.slice(0,8)}... - ${s.totalDependencies} deps (${new Date(s.completedAt||s.startedAt||"").toLocaleDateString()})`,value:s.id}))});async function D(){w.value=!0;try{const[a]=await Promise.all([k.listScans({status:"complete",pageSize:100})]);g.value=a.data.scans;const s=g.value.map(async d=>{try{return(await k.getCurationSessionByScan(d.id)).data}catch{return null}}),e=await Promise.all(s);r.value=e.filter(d=>d!==null)}catch(a){console.error("Failed to fetch curation data",a),b.add({severity:"error",summary:"Error",detail:"Failed to load curation sessions",life:3e3})}finally{w.value=!1}}async function $(){if(v.value){S.value=!0;try{const a=await k.startCurationSession(v.value);r.value.unshift(a.data),m.value=!1,v.value=null,b.add({severity:"success",summary:"Success",detail:"Curation session started",life:3e3}),I.push(`/curations/${a.data.scanId}`)}catch(a){console.error("Failed to start curation",a),b.add({severity:"error",summary:"Error",detail:"Failed to start curation session",life:3e3})}finally{S.value=!1}}}function A(a){switch(a){case"APPROVED":return"success";case"COMPLETED":return"info";case"IN_PROGRESS":return"warning";default:return"secondary"}}function R(a){return a.statistics.total===0?100:Math.round((a.statistics.total-a.statistics.pending)/a.statistics.total*100)}function x(a){return g.value.find(s=>s.id===a)}return N(D),(a,s)=>(u(),c("div",z,[t("header",X,[s[4]||(s[4]=t("div",null,[t("h1",null,"License Curation"),t("p",{class:"subtitle"},"Review and approve AI-suggested licenses")],-1)),i(l(_),{label:"Start New Curation",icon:"pi pi-plus",onClick:s[0]||(s[0]=e=>m.value=!0),disabled:h.value.length===0},null,8,["disabled"])]),w.value?(u(),c("div",Y,[...s[5]||(s[5]=[t("i",{class:"pi pi-spin pi-spinner"},null,-1),y(" Loading curation sessions... ",-1)])])):(u(),c(L,{key:1},[t("div",q,[t("div",H,[t("div",J,o(r.value.length),1),s[6]||(s[6]=t("div",{class:"card-label"},"Total Sessions",-1))]),t("div",K,[t("div",Q,o(r.value.filter(e=>e.status==="APPROVED").length),1),s[7]||(s[7]=t("div",{class:"card-label"},"Approved",-1))]),t("div",W,[t("div",Z,o(r.value.filter(e=>e.status==="IN_PROGRESS").length),1),s[8]||(s[8]=t("div",{class:"card-label"},"In Progress",-1))]),t("div",ss,[t("div",es,o(r.value.reduce((e,d)=>e+d.statistics.total,0)),1),s[9]||(s[9]=t("div",{class:"card-label"},"Total Items",-1))])]),r.value.length>0?(u(),c("div",ts,[i(l(B),{value:r.value,stripedRows:"",showGridlines:"",class:"p-datatable-sm",paginator:r.value.length>10,rows:10,emptyMessage:"No curation sessions yet. Start one by selecting a completed scan."},{default:n(()=>[i(l(p),{header:"Scan",style:{"min-width":"200px"}},{body:n(({data:e})=>{var d;return[t("div",as,[i(l(F),{to:`/scans/${e.scanId}`,class:"scan-link"},{default:n(()=>[y(o(e.scanId.slice(0,8))+"... ",1)]),_:2},1032,["to"]),x(e.scanId)?(u(),c("div",ls,o((d=x(e.scanId))==null?void 0:d.totalDependencies)+" dependencies ",1)):C("",!0)])]}),_:1}),i(l(p),{field:"status",header:"Status",style:{width:"130px"},sortable:""},{body:n(({data:e})=>[i(l(T),{value:e.status,severity:A(e.status)},null,8,["value","severity"])]),_:1}),i(l(p),{header:"Progress",style:{width:"200px"}},{body:n(({data:e})=>[t("div",is,[i(l(U),{value:R(e),showValue:!1,style:{height:"8px"}},null,8,["value"]),t("span",os,o(e.statistics.total-e.statistics.pending)+" / "+o(e.statistics.total),1)])]),_:1}),i(l(p),{header:"Decisions",style:{width:"200px"}},{body:n(({data:e})=>[t("div",ns,[t("span",rs,[s[10]||(s[10]=t("i",{class:"pi pi-check"},null,-1)),y(" "+o(e.statistics.accepted),1)]),t("span",ds,[s[11]||(s[11]=t("i",{class:"pi pi-times"},null,-1)),y(" "+o(e.statistics.rejected),1)]),t("span",cs,[s[12]||(s[12]=t("i",{class:"pi pi-pencil"},null,-1)),y(" "+o(e.statistics.modified),1)])])]),_:1}),i(l(p),{header:"Approval",style:{width:"180px"}},{body:n(({data:e})=>[e.approval?(u(),c("div",us,[s[13]||(s[13]=t("i",{class:"pi pi-check-circle"},null,-1)),t("span",null,o(e.approval.approvedBy),1),t("div",ps,o(new Date(e.approval.approvedAt).toLocaleDateString()),1)])):(u(),c("span",vs,"Not approved"))]),_:1}),i(l(p),{field:"createdAt",header:"Created",style:{width:"140px"},sortable:""},{body:n(({data:e})=>[y(o(new Date(e.createdAt).toLocaleDateString()),1)]),_:1}),i(l(p),{header:"Actions",style:{width:"100px"}},{body:n(({data:e})=>[i(l(_),{icon:"pi pi-arrow-right",severity:"secondary",text:"",rounded:"",onClick:d=>l(I).push(`/curations/${e.scanId}`),title:"Open session"},null,8,["onClick"])]),_:1})]),_:1},8,["value","paginator"])])):C("",!0)],64)),i(l(G),{visible:m.value,"onUpdate:visible":s[3]||(s[3]=e=>m.value=e),header:"Start New Curation Session",modal:!0,style:{width:"500px"}},{footer:n(()=>[i(l(_),{label:"Cancel",severity:"secondary",onClick:s[2]||(s[2]=e=>m.value=!1)}),i(l(_),{label:"Start Curation",icon:"pi pi-play",onClick:$,loading:S.value,disabled:!v.value},null,8,["loading","disabled"])]),default:n(()=>[t("div",fs,[s[16]||(s[16]=t("p",null,"Select a completed scan to start a curation session. You'll be able to review and approve AI-suggested licenses for each dependency.",-1)),t("div",ys,[s[14]||(s[14]=t("label",null,"Select Scan",-1)),i(l(j),{modelValue:v.value,"onUpdate:modelValue":s[1]||(s[1]=e=>v.value=e),options:h.value,optionLabel:"label",optionValue:"value",placeholder:"Choose a scan...",class:"w-full",disabled:h.value.length===0},null,8,["modelValue","options","disabled"])]),h.value.length===0?(u(),c("div",ms,[...s[15]||(s[15]=[t("i",{class:"pi pi-info-circle"},null,-1),t("span",null,"No eligible scans available. All completed scans already have curation sessions.",-1)])])):C("",!0)])]),_:1},8,["visible"])]))}}),Is=O(gs,[["__scopeId","data-v-9748b9d0"]]);export{Is as default};
