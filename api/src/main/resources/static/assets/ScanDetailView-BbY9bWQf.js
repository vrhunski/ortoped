import{d as Q,g as Z,x as ge,c as o,a as s,t as d,b as m,e as g,y as N,i as a,u as i,F as H,f as me,k as n,_ as ee,l as fe,o as he,r as h,j as w,R as B,p as U,q as Y,v as we,h as _,s as be}from"./index-D4N1nedD.js";import{s as k,a as E,b as ke,c as K,d as S}from"./column.esm-CzM7doIv.js";const Re={class:"license-popup"},Se={class:"popup-header"},_e={key:0},xe={key:1},Ce={class:"popup-content"},Le={key:0,class:"license-loading"},Pe={key:1,class:"license-error"},De={key:2,class:"license-details"},$e={class:"license-meta"},Oe={class:"meta-item"},Ee={class:"license-id"},Fe={class:"meta-badges"},Ie={key:0,class:"see-also-section"},Ve={class:"see-also-list"},Te=["href"],Ue={key:1,class:"header-section"},Ne={class:"license-header"},Ae={key:2,class:"license-text-section"},Me={class:"license-text"},je=Q({__name:"LicenseDetailPopup",props:{visible:{type:Boolean},license:{},loading:{type:Boolean},error:{}},emits:["close"],setup(y,{emit:x}){const R=x;return(b,v)=>Z((n(),o("div",Re,[s("div",Se,[y.license?(n(),o("h4",_e,d(y.license.name),1)):(n(),o("h4",xe,"License Details")),s("button",{class:"close-btn",onClick:v[0]||(v[0]=L=>R("close")),"aria-label":"Close"},[...v[1]||(v[1]=[s("i",{class:"pi pi-times"},null,-1)])])]),s("div",Ce,[y.loading?(n(),o("div",Le,[...v[2]||(v[2]=[s("i",{class:"pi pi-spin pi-spinner"},null,-1),g(" Loading license details... ",-1)])])):y.error?(n(),o("div",Pe,[v[3]||(v[3]=s("i",{class:"pi pi-exclamation-triangle"},null,-1)),g(" "+d(y.error),1)])):y.license?(n(),o("div",De,[s("div",$e,[s("div",Oe,[v[4]||(v[4]=s("span",{class:"meta-label"},"License ID",-1)),s("code",Ee,d(y.license.licenseId),1)]),s("div",Fe,[y.license.isOsiApproved?(n(),N(i(k),{key:0,value:"OSI Approved",severity:"success"})):m("",!0),y.license.isFsfLibre?(n(),N(i(k),{key:1,value:"FSF Libre",severity:"info"})):m("",!0),y.license.isDeprecated?(n(),N(i(k),{key:2,value:"Deprecated",severity:"danger"})):m("",!0),a(i(k),{value:y.license.category,severity:"secondary"},null,8,["value"])])]),y.license.seeAlso.length>0?(n(),o("div",Ie,[v[6]||(v[6]=s("strong",null,"References:",-1)),s("ul",Ve,[(n(!0),o(H,null,me(y.license.seeAlso,L=>(n(),o("li",{key:L},[s("a",{href:L,target:"_blank",rel:"noopener noreferrer"},[v[5]||(v[5]=s("i",{class:"pi pi-external-link"},null,-1)),g(" "+d(L),1)],8,Te)]))),128))])])):m("",!0),y.license.standardHeader?(n(),o("div",Ue,[v[7]||(v[7]=s("strong",null,"Standard License Header:",-1)),s("pre",Ne,d(y.license.standardHeader),1)])):m("",!0),y.license.licenseText?(n(),o("div",Ae,[v[8]||(v[8]=s("strong",null,"Full License Text:",-1)),s("pre",Me,d(y.license.licenseText),1)])):m("",!0)])):m("",!0)])],512)),[[ge,y.visible]])}}),Be=ee(je,[["__scopeId","data-v-9d90f30d"]]),He={class:"scan-detail"},Ge={key:0,class:"loading"},qe={class:"page-header"},ze={class:"breadcrumb"},We={class:"scan-meta"},Xe={key:0,class:"header-actions"},Je={key:0,class:"section scanning-state"},Ye={key:1,class:"section error-state"},Ke={class:"compliance-icon"},Qe={class:"compliance-info"},Ze={class:"compliance-stats"},es={key:0,class:"stat"},ss={key:1,class:"stat"},ts={key:2,class:"stat"},ls={key:3,class:"stat"},is={class:"section policy-section"},ns={class:"policy-controls"},as={class:"policy-selector"},os={key:0,class:"no-policies"},ds={class:"section curation-section"},cs={key:0,class:"curation-status"},rs={class:"curation-info"},us={class:"curation-stats"},ps={class:"stat-item accepted"},vs={class:"stat-item rejected"},ys={class:"stat-item modified"},gs={key:1,class:"no-curation"},ms={key:1,class:"section violations-section"},fs={class:"section-header"},hs={class:"dependency-name"},ws={class:"license-badge"},bs={class:"rule-name"},ks={class:"violation-message"},Rs={key:0,class:"suggestion"},Ss={class:"section"},_s={class:"section-header"},xs={class:"dep-id"},Cs={class:"license-badge"},Ls={key:0,class:"ai-suggestion"},Ps={class:"suggested-license"},Ds={class:"reasoning"},$s={key:1,class:"no-suggestion"},Os=["onMouseenter"],Es={class:"suggested-license"},Fs={key:1,class:"no-suggestion"},Is=Q({__name:"ScanDetailView",setup(y){const x=be(),R=fe(),b=h(null),v=h([]),L=h(!0),G=h(0),A=h(""),D=h([]),$=h(null),F=h(!1),r=h(null),M=h(!1),I=h(null),V=h(!1),T=h(null),se=h(null),f=h(null),O=h(!1),q=Y(()=>{let l=[...v.value];if(A.value){const e=A.value.toLowerCase();l=l.filter(t=>{var c;return t.name.toLowerCase().includes(e)||((c=t.concludedLicense)==null?void 0:c.toLowerCase().includes(e))})}return l.sort((e,t)=>!e.isResolved&&e.aiSuggestion&&(t.isResolved||!t.aiSuggestion)?-1:!t.isResolved&&t.aiSuggestion&&(e.isResolved||!e.aiSuggestion)?1:!e.isResolved&&t.isResolved?-1:!t.isResolved&&e.isResolved?1:e.name.localeCompare(t.name)),l}),te=Y(()=>D.value.map(l=>({label:l.name+(l.isDefault?" (Default)":""),value:l.id})));async function le(){L.value=!0;try{const[l,e]=await Promise.all([_.getScan(x.params.id),_.listPolicies(1,100)]);b.value=l.data,D.value=e.data.policies;const t=D.value.find(c=>c.isDefault);if(t?$.value=t.id:D.value.length>0&&($.value=D.value[0].id),b.value.status==="complete"){const c=[];let u=1;const p=100;let P=!0;for(;P;){const C=await _.getDependencies(x.params.id,u,p);c.push(...C.data.dependencies),G.value=C.data.total,c.length>=C.data.total?P=!1:u++}v.value=c,await Promise.all([ae(),oe()])}}catch(l){console.error("Failed to fetch scan data",l),R.add({severity:"error",summary:"Error",detail:"Failed to fetch scan data",life:3e3})}finally{L.value=!1}}async function ie(){var l,e;if(!(!$.value||!b.value)){F.value=!0,r.value=null;try{const c=(await _.evaluatePolicy(b.value.id,$.value)).data,u=JSON.parse(c.report);r.value={policyId:c.policyId,policyName:u.policyName,scanId:c.scanId,passed:c.passed,errorCount:c.errorCount,warningCount:c.warningCount,infoCount:((l=u.summary)==null?void 0:l.infoCount)||0,violations:((e=u.violations)==null?void 0:e.map(p=>({severity:p.severity,rule:p.ruleName,message:p.message,dependency:p.dependencyName,license:p.license,suggestion:p.aiSuggestion})))||[],evaluatedAt:c.createdAt},r.value.passed?R.add({severity:"success",summary:"Policy Check Passed",detail:"No violations found",life:3e3}):R.add({severity:"warn",summary:"Policy Check Failed",detail:`Found ${r.value.errorCount} errors, ${r.value.warningCount} warnings`,life:5e3})}catch(t){console.error("Failed to evaluate policy",t),R.add({severity:"error",summary:"Error",detail:"Failed to run policy check",life:3e3})}finally{F.value=!1}}}async function ne(l){try{const e=await _.generateSbom(x.params.id,l),t=new Blob([e.data.content],{type:"application/json"}),c=URL.createObjectURL(t),u=document.createElement("a");u.href=c,u.download=e.data.filename,u.click(),URL.revokeObjectURL(c)}catch(e){console.error("Failed to download SBOM",e),R.add({severity:"error",summary:"Error",detail:"Failed to download SBOM",life:3e3})}}async function ae(){try{const l=await _.getReportSummary(x.params.id);se.value=l.data}catch(l){console.error("Failed to fetch report summary",l)}}async function oe(){try{const l=await _.getCurationSessionByScan(x.params.id);f.value=l.data}catch{f.value=null}}async function z(l){O.value=!0;try{const e=await _.generateReport(x.params.id,{format:l,includePolicy:!0,includeCuration:!0,includeAuditTrail:!0,includeDependencyDetails:!0}),t=e.data.content,c=e.data.filename,u=l==="html"?"text/html":"application/json",p=new Blob([t],{type:u}),P=URL.createObjectURL(p),C=document.createElement("a");C.href=P,C.download=c,C.click(),URL.revokeObjectURL(P),R.add({severity:"success",summary:"Success",detail:`Report downloaded as ${l.toUpperCase()}`,life:2e3})}catch(e){console.error("Failed to download report",e),R.add({severity:"error",summary:"Error",detail:"Failed to generate report",life:3e3})}finally{O.value=!1}}async function de(){O.value=!0;try{const l=await _.downloadOrtExport(x.params.id),e=l.data.content,t=l.data.filename,c=new Blob([e],{type:"application/json"}),u=URL.createObjectURL(c),p=document.createElement("a");p.href=u,p.download=t,p.click(),URL.revokeObjectURL(u),R.add({severity:"success",summary:"Success",detail:"ORT export downloaded",life:2e3})}catch(l){console.error("Failed to download ORT export",l),R.add({severity:"error",summary:"Error",detail:"Failed to generate ORT export",life:3e3})}finally{O.value=!1}}function ce(l){switch(l){case"HIGH":return"confidence-high";case"MEDIUM":return"confidence-medium";default:return"confidence-low"}}function re(l){switch(l){case"ERROR":return"danger";case"WARNING":return"warning";case"INFO":return"info";default:return"secondary"}}async function ue(l){V.value=!0,T.value=null,I.value=null;try{const e=await _.getSpdxLicense(l);I.value=e.data}catch(e){console.error("Failed to fetch license details",e),T.value="Failed to load license details"}finally{V.value=!1}}function pe(l,e){e&&(M.value=!0,ue(e),setTimeout(()=>{const t=document.querySelector(".license-popup");if(t){let c=l.pageX+10,u=l.pageY+10;const p=t.getBoundingClientRect();c+p.width>window.innerWidth&&(c=l.pageX-p.width-10),u+p.height>window.innerHeight&&(u=l.pageY-p.height-10),t.style.left=c+"px",t.style.top=u+"px"}},10))}let j=null;function ve(){j=setTimeout(()=>{M.value=!1,setTimeout(()=>{I.value=null,T.value=null,V.value=!1},300)},200)}function ye(){j&&(clearTimeout(j),j=null)}function W(){M.value=!1,setTimeout(()=>{I.value=null,T.value=null,V.value=!1},300)}return he(le),(l,e)=>(n(),o("div",He,[L.value?(n(),o("div",Ge,[...e[5]||(e[5]=[s("i",{class:"pi pi-spin pi-spinner"},null,-1),g(" Loading... ",-1)])])):b.value?(n(),o(H,{key:1},[s("header",qe,[s("div",null,[s("div",ze,[a(i(B),{to:"/scans"},{default:w(()=>[...e[6]||(e[6]=[g("Scans",-1)])]),_:1}),e[7]||(e[7]=s("i",{class:"pi pi-angle-right"},null,-1)),e[8]||(e[8]=s("span",null,"Scan Details",-1))]),e[9]||(e[9]=s("h1",null,"Scan Details",-1)),s("div",We,[s("span",{class:U(["status-badge",b.value.status==="complete"?"status-success":"status-warning"])},d(b.value.status),3),s("span",null,"Created: "+d(new Date(b.value.createdAt).toLocaleString()),1)])]),b.value.status==="complete"?(n(),o("div",Xe,[a(i(E),{label:"Export SBOM",icon:"pi pi-download",severity:"secondary",onClick:e[0]||(e[0]=t=>ne("cyclonedx-json"))}),a(i(E),{label:"Report (JSON)",icon:"pi pi-file",severity:"secondary",onClick:e[1]||(e[1]=t=>z("json")),loading:O.value},null,8,["loading"]),a(i(E),{label:"Report (HTML)",icon:"pi pi-file",severity:"secondary",onClick:e[2]||(e[2]=t=>z("html")),loading:O.value},null,8,["loading"]),a(i(E),{label:"ORT Export",icon:"pi pi-share-alt",severity:"secondary",onClick:de,loading:O.value,title:"Export in ORT Evaluator format"},null,8,["loading"])])):m("",!0)]),b.value.status==="scanning"?(n(),o("div",Je,[...e[10]||(e[10]=[s("i",{class:"pi pi-spin pi-spinner"},null,-1),s("h3",null,"Scan in Progress",-1),s("p",null,"Analyzing dependencies and resolving licenses...",-1)])])):b.value.status==="failed"?(n(),o("div",Ye,[e[11]||(e[11]=s("i",{class:"pi pi-times-circle"},null,-1)),e[12]||(e[12]=s("h3",null,"Scan Failed",-1)),s("p",null,d(b.value.errorMessage||"An unknown error occurred"),1)])):(n(),o(H,{key:2},[r.value?(n(),o("div",{key:0,class:U(["compliance-banner",r.value.passed?"compliance-passed":"compliance-failed"])},[s("div",Ke,[s("i",{class:U(r.value.passed?"pi pi-check-circle":"pi pi-times-circle")},null,2)]),s("div",Qe,[s("h3",null,d(r.value.passed?"Policy Check Passed":"Policy Check Failed"),1),s("p",null,"Policy: "+d(r.value.policyName),1)]),s("div",Ze,[r.value.errorCount>0?(n(),o("div",es,[a(i(k),{value:r.value.errorCount,severity:"danger"},null,8,["value"]),e[13]||(e[13]=s("span",null,"Errors",-1))])):m("",!0),r.value.warningCount>0?(n(),o("div",ss,[a(i(k),{value:r.value.warningCount,severity:"warning"},null,8,["value"]),e[14]||(e[14]=s("span",null,"Warnings",-1))])):m("",!0),r.value.infoCount>0?(n(),o("div",ts,[a(i(k),{value:r.value.infoCount,severity:"info"},null,8,["value"]),e[15]||(e[15]=s("span",null,"Info",-1))])):m("",!0),r.value.passed?(n(),o("div",ls,[a(i(k),{value:"0",severity:"success"}),e[16]||(e[16]=s("span",null,"Violations",-1))])):m("",!0)])],2)):m("",!0),s("div",is,[e[21]||(e[21]=s("div",{class:"section-header"},[s("h2",null,[s("i",{class:"pi pi-shield"}),g(" Policy Compliance")])],-1)),s("div",ns,[s("div",as,[e[17]||(e[17]=s("label",null,"Select Policy:",-1)),a(i(ke),{modelValue:$.value,"onUpdate:modelValue":e[3]||(e[3]=t=>$.value=t),options:te.value,optionLabel:"label",optionValue:"value",placeholder:"Select a policy",class:"policy-dropdown",disabled:F.value||D.value.length===0},null,8,["modelValue","options","disabled"])]),a(i(E),{label:"Run Policy Check",icon:"pi pi-play",onClick:ie,loading:F.value,disabled:!$.value||F.value},null,8,["loading","disabled"])]),D.value.length===0?(n(),o("p",os,[e[19]||(e[19]=g(" No policies available. ",-1)),a(i(B),{to:"/policies"},{default:w(()=>[...e[18]||(e[18]=[g("Create a policy",-1)])]),_:1}),e[20]||(e[20]=g(" to run compliance checks. ",-1))])):m("",!0)]),s("div",ds,[e[26]||(e[26]=s("div",{class:"section-header"},[s("h2",null,[s("i",{class:"pi pi-check-square"}),g(" License Curation")])],-1)),f.value?(n(),o("div",cs,[s("div",rs,[a(i(k),{value:f.value.status,severity:f.value.status==="APPROVED"?"success":f.value.status==="IN_PROGRESS"?"warning":"info"},null,8,["value","severity"]),s("div",us,[s("span",null,[s("strong",null,d(f.value.statistics.total-f.value.statistics.pending),1),g(" / "+d(f.value.statistics.total)+" reviewed",1)]),s("span",ps,[e[22]||(e[22]=s("i",{class:"pi pi-check"},null,-1)),g(" "+d(f.value.statistics.accepted)+" accepted",1)]),s("span",vs,[e[23]||(e[23]=s("i",{class:"pi pi-times"},null,-1)),g(" "+d(f.value.statistics.rejected)+" rejected",1)]),s("span",ys,[e[24]||(e[24]=s("i",{class:"pi pi-pencil"},null,-1)),g(" "+d(f.value.statistics.modified)+" modified",1)])])]),a(i(B),{to:`/curations/${f.value.scanId}`},{default:w(()=>[a(i(E),{label:f.value.status==="APPROVED"?"View Curation":"Continue Curation",icon:f.value.status==="APPROVED"?"pi pi-eye":"pi pi-arrow-right",severity:f.value.status==="APPROVED"?"secondary":"primary"},null,8,["label","icon","severity"])]),_:1},8,["to"])])):(n(),o("div",gs,[e[25]||(e[25]=s("p",null,"No curation session started for this scan. Start one to review and approve AI-suggested licenses.",-1)),a(i(B),{to:"/curations"},{default:w(()=>[a(i(E),{label:"Start Curation",icon:"pi pi-plus"})]),_:1})]))]),r.value&&r.value.violations.length>0?(n(),o("div",ms,[s("div",fs,[s("h2",null,[e[27]||(e[27]=s("i",{class:"pi pi-exclamation-triangle"},null,-1)),g(" Violations ("+d(r.value.violations.length)+")",1)])]),a(i(K),{value:r.value.violations,stripedRows:"",showGridlines:"",class:"p-datatable-sm",paginator:r.value.violations.length>10,rows:10},{default:w(()=>[a(i(S),{field:"severity",header:"Severity",style:{width:"100px"},sortable:""},{body:w(({data:t})=>[a(i(k),{value:t.severity,severity:re(t.severity)},null,8,["value","severity"])]),_:1}),a(i(S),{field:"dependency",header:"Dependency",style:{"min-width":"200px"},sortable:""},{body:w(({data:t})=>[s("code",hs,d(t.dependency),1)]),_:1}),a(i(S),{field:"license",header:"License",style:{width:"150px"},sortable:""},{body:w(({data:t})=>[s("span",ws,d(t.license||"Unknown"),1)]),_:1}),a(i(S),{field:"rule",header:"Rule",style:{width:"150px"},sortable:""},{body:w(({data:t})=>[s("span",bs,d(t.rule),1)]),_:1}),a(i(S),{field:"message",header:"Message",style:{"min-width":"250px"}},{body:w(({data:t})=>[s("div",ks,[g(d(t.message)+" ",1),t.suggestion?(n(),o("div",Rs,[e[28]||(e[28]=s("i",{class:"pi pi-lightbulb"},null,-1)),g(" "+d(t.suggestion),1)])):m("",!0)])]),_:1})]),_:1},8,["value","paginator"])])):m("",!0),s("div",Ss,[s("div",_s,[s("h2",null,"Dependencies ("+d(G.value)+")",1),Z(s("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>A.value=t),type:"text",placeholder:"Filter dependencies...",class:"filter-input"},null,512),[[we,A.value]])]),a(i(K),{value:q.value,stripedRows:"",showGridlines:"",class:"p-datatable-sm",paginator:q.value.length>20,rows:20},{default:w(()=>[a(i(S),{field:"name",header:"Package",style:{"min-width":"200px"},sortable:""},{body:w(({data:t})=>[s("div",null,[s("strong",null,d(t.name),1),s("div",xs,d(t.id),1)])]),_:1}),a(i(S),{field:"version",header:"Version",style:{width:"120px"},sortable:""}),a(i(S),{header:"License",style:{width:"150px"}},{body:w(({data:t})=>[s("span",Cs,d(t.concludedLicense||t.declaredLicenses[0]||"Unknown"),1)]),_:1}),a(i(S),{field:"isResolved",header:"Status",style:{width:"120px"}},{body:w(({data:t})=>[t.isResolved?(n(),N(i(k),{key:0,value:"Resolved",severity:"success"})):(n(),N(i(k),{key:1,value:"Unresolved",severity:"warning"}))]),_:1}),a(i(S),{header:"AI Suggestion",style:{"min-width":"200px"}},{body:w(({data:t})=>[t.aiSuggestion?(n(),o("div",Ls,[s("span",Ps,d(t.aiSuggestion.suggestedLicense),1),s("span",{class:U(["confidence",ce(t.aiSuggestion.confidence)])},d(t.aiSuggestion.confidence),3),s("div",Ds,d(t.aiSuggestion.reasoning),1)])):(n(),o("span",$s,"-"))]),_:1}),a(i(S),{header:"SPDX Suggestion",style:{"min-width":"200px"}},{body:w(({data:t})=>{var c,u,p,P;return[(c=t.spdxLicense)!=null&&c.licenseId||(u=t.spdxSuggestion)!=null&&u.licenseId?(n(),o("div",{key:0,class:"spdx-suggestion",onMouseenter:C=>{var X,J;return pe(C,((X=t.spdxLicense)==null?void 0:X.licenseId)||((J=t.spdxSuggestion)==null?void 0:J.licenseId))},onMouseleave:ve},[s("span",Es,d(((p=t.spdxLicense)==null?void 0:p.licenseId)||((P=t.spdxSuggestion)==null?void 0:P.licenseId)),1),s("span",{class:U(["spdx-badge",t.spdxValidated?"spdx-valid":"spdx-invalid"])},d(t.spdxValidated?"✓ Valid":"⚠ Invalid"),3)],40,Os)):(n(),o("span",Fs,"-"))]}),_:1})]),_:1},8,["value","paginator"])])],64))],64)):m("",!0),a(Be,{visible:M.value,license:I.value,loading:V.value,error:T.value,onMouseenter:ye,onMouseleave:W,onClose:W},null,8,["visible","license","loading","error"])]))}}),Us=ee(Is,[["__scopeId","data-v-5308c530"]]);export{Us as default};
