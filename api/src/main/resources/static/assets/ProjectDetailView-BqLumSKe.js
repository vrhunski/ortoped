import{d as E,l as O,m as z,o as J,n as q,c as i,b as y,r as f,a as e,e as u,F as L,i as v,j as N,u as g,R as $,t as o,p as _,q as G,f as H,h as m,s as K,k as r,_ as Y}from"./index-DzC_UEuu.js";import{s as V}from"./inputswitch.esm-bNcESy3l.js";const Q={class:"project-detail"},W={key:0,class:"loading"},X={class:"page-header"},Z={class:"breadcrumb"},ee={class:"project-meta"},se={key:0},ae={class:"section scan-config-section"},le={class:"scan-config-panel"},te={class:"config-row"},ne={class:"config-row"},oe={class:"scan-actions"},ie=["disabled"],re=["disabled"],ue={class:"section"},de={class:"section-header"},ce={key:0,class:"scanning-indicator"},pe={key:0,class:"empty-state"},fe={key:1,class:"data-table"},ve={key:0,class:"pi pi-spin pi-spinner status-spinner"},ge={class:"duration-cell"},F="ortoped.scanConfig",me=3e3,Se=E({__name:"ProjectDetailView",setup(be){const w=O(),j=K(),n=f(null),c=f([]),A=f(!0),d=f(!1),t=f({enableAi:!0,enableSourceScan:!1,parallelAiCalls:!0});let p=null;const C=G(()=>c.value.some(a=>a.status==="pending"||a.status==="scanning"));function U(){const a=localStorage.getItem(F);if(a)try{t.value={...t.value,...JSON.parse(a)}}catch{console.warn("Failed to parse saved scan config")}}function M(){localStorage.setItem(F,JSON.stringify(t.value))}function x(a,s){if(!a)return"-";const l=new Date(a).getTime(),P=(s?new Date(s).getTime():Date.now())-l;if(P<0)return"-";const S=Math.floor(P/1e3),b=Math.floor(S/60),R=Math.floor(b/60);return R>0?`${R}h ${b%60}m ${S%60}s`:b>0?`${b}m ${S%60}s`:`${S}s`}async function B(){A.value=!0;try{const[a,s]=await Promise.all([m.getProject(j.params.id),m.listScans({projectId:j.params.id,pageSize:20})]);n.value=a.data,c.value=s.data.scans}catch(a){console.error("Failed to fetch project data",a)}finally{A.value=!1}}async function k(){if(n.value)try{const a=await m.listScans({projectId:n.value.id,pageSize:20});c.value=a.data.scans}catch(a){console.error("Failed to refresh scans",a)}}function D(){p||(p=window.setInterval(async()=>{if(!C.value){h();return}await k()},me))}function h(){p&&(clearInterval(p),p=null)}async function I(a=!1){if(n.value){d.value=!0,M();try{if(a)await m.triggerScan({projectId:n.value.id,enableAi:!0,enableSourceScan:!1,parallelAiCalls:!0,demoMode:!0}),w.add({severity:"success",summary:"Demo Scan Started",detail:"Demo scan started with default settings",life:3e3});else{await m.triggerScan({projectId:n.value.id,enableAi:t.value.enableAi,enableSourceScan:t.value.enableSourceScan,parallelAiCalls:t.value.parallelAiCalls,demoMode:!1});const s=[t.value.enableAi?"AI":null,t.value.enableSourceScan?"Source Scan":null,t.value.parallelAiCalls&&t.value.enableAi?"Parallel":null].filter(Boolean).join(", ");w.add({severity:"success",summary:"Scan Started",detail:s?`Scan started with: ${s}`:"Scan started",life:3e3})}await k(),D()}catch(s){console.error("Failed to trigger scan",s),w.add({severity:"error",summary:"Scan Failed",detail:"Failed to start scan",life:5e3})}finally{d.value=!1}}}function T(a){switch(a){case"complete":return"status-success";case"scanning":return"status-warning";case"failed":return"status-error";default:return"status-pending"}}return z(C,a=>{a?D():h()}),J(()=>{U(),B()}),q(()=>{h()}),(a,s)=>(r(),i("div",Q,[A.value?(r(),i("div",W,[...s[5]||(s[5]=[e("i",{class:"pi pi-spin pi-spinner"},null,-1),u(" Loading... ",-1)])])):n.value?(r(),i(L,{key:1},[e("header",X,[e("div",null,[e("div",Z,[v(g($),{to:"/projects"},{default:N(()=>[...s[6]||(s[6]=[u("Projects",-1)])]),_:1}),s[7]||(s[7]=e("i",{class:"pi pi-angle-right"},null,-1)),e("span",null,o(n.value.name),1)]),e("h1",null,o(n.value.name),1),e("div",ee,[n.value.repositoryUrl?(r(),i("span",se,[s[8]||(s[8]=e("i",{class:"pi pi-github"},null,-1)),u(" "+o(n.value.repositoryUrl),1)])):y("",!0),e("span",null,[s[9]||(s[9]=e("i",{class:"pi pi-code-branch"},null,-1)),u(" "+o(n.value.defaultBranch),1)])])])]),e("div",ae,[s[14]||(s[14]=e("h2",null,"Scan Configuration",-1)),e("div",le,[e("div",te,[s[10]||(s[10]=e("div",{class:"config-info"},[e("span",{class:"config-label"},"Enable AI Analysis"),e("span",{class:"config-description"},"Use Claude to resolve unknown licenses")],-1)),v(g(V),{modelValue:t.value.enableAi,"onUpdate:modelValue":s[0]||(s[0]=l=>t.value.enableAi=l)},null,8,["modelValue"])]),e("div",ne,[s[11]||(s[11]=e("div",{class:"config-info"},[e("span",{class:"config-label"},"Source Code Scan"),e("span",{class:"config-description"},"Deep scan with ScanCode (slower)")],-1)),v(g(V),{modelValue:t.value.enableSourceScan,"onUpdate:modelValue":s[1]||(s[1]=l=>t.value.enableSourceScan=l)},null,8,["modelValue"])]),e("div",{class:_(["config-row",{disabled:!t.value.enableAi}])},[s[12]||(s[12]=e("div",{class:"config-info"},[e("span",{class:"config-label"},"Parallel AI Processing"),e("span",{class:"config-description"},"Process packages concurrently")],-1)),v(g(V),{modelValue:t.value.parallelAiCalls,"onUpdate:modelValue":s[2]||(s[2]=l=>t.value.parallelAiCalls=l),disabled:!t.value.enableAi},null,8,["modelValue","disabled"])],2)]),e("div",oe,[e("button",{class:"btn btn-secondary",onClick:s[3]||(s[3]=l=>I(!0)),disabled:d.value},[...s[13]||(s[13]=[e("i",{class:"pi pi-play"},null,-1),u(" Demo Scan ",-1)])],8,ie),e("button",{class:"btn btn-primary",onClick:s[4]||(s[4]=l=>I(!1)),disabled:d.value||!n.value.repositoryUrl},[e("i",{class:_(["pi pi-refresh",{"pi-spin":d.value}])},null,2),u(" "+o(d.value?"Starting...":"Run Scan"),1)],8,re)])]),e("div",ue,[e("div",de,[s[16]||(s[16]=e("h2",null,"Scan History",-1)),C.value?(r(),i("span",ce,[...s[15]||(s[15]=[e("i",{class:"pi pi-spin pi-spinner"},null,-1),u(" Scanning... ",-1)])])):y("",!0)]),c.value.length===0?(r(),i("div",pe,[...s[17]||(s[17]=[e("p",null,"No scans yet. Run your first scan to see results here.",-1)])])):(r(),i("table",fe,[s[19]||(s[19]=e("thead",null,[e("tr",null,[e("th",null,"Status"),e("th",null,"Dependencies"),e("th",null,"Resolved"),e("th",null,"Unresolved"),e("th",null,"AI Resolved"),e("th",null,"Duration"),e("th",null,"Completed"),e("th")])],-1)),e("tbody",null,[(r(!0),i(L,null,H(c.value,l=>(r(),i("tr",{key:l.id},[e("td",null,[e("span",{class:_(["status-badge",T(l.status)])},[l.status==="scanning"?(r(),i("i",ve)):y("",!0),u(" "+o(l.status),1)],2)]),e("td",null,o(l.totalDependencies),1),e("td",null,o(l.resolvedLicenses),1),e("td",null,o(l.unresolvedLicenses),1),e("td",null,o(l.aiResolvedLicenses),1),e("td",ge,o(x(l.startedAt,l.completedAt)),1),e("td",null,o(l.completedAt?new Date(l.completedAt).toLocaleString():"-"),1),e("td",null,[v(g($),{to:`/scans/${l.id}`,class:"btn btn-small"},{default:N(()=>[...s[18]||(s[18]=[u(" View ",-1)])]),_:1},8,["to"])])]))),128))])]))])],64)):y("",!0)]))}}),Ce=Y(Se,[["__scopeId","data-v-8a7adf65"]]);export{Ce as default};
