import{d as J,l as F,o as M,c as T,a as i,i as s,u as t,j as a,r as n,h as D,y as U,b as W,t as P,e as N,g as x,z as _,A as j,k as V,_ as z}from"./index-D4N1nedD.js";import{a as r,c as Y,d as g,s as h,e as q,f as H}from"./column.esm-CzM7doIv.js";import{s as $}from"./dialog.esm-CtgzFj8g.js";import{s as K}from"./textarea.esm-Dt7O-9pY.js";const Q={class:"policies-page"},X={class:"page-header"},Z={class:"section"},ee={class:"empty-state"},le={class:"policy-name"},ie={class:"action-buttons"},te={class:"form-group"},oe={class:"form-group"},se={class:"form-group checkbox-group"},ae={class:"delete-confirm"},ne=J({__name:"PoliciesView",setup(re){const A=_(),u=F(),k=n([]),b=n(!0),d=n(!1),p=n(!1),y=n(null),c=n(""),f=n(""),m=n(!1),v=n(!1),E={version:"1.0",name:"",description:"",rules:[{name:"deny-copyleft",description:"Deny strong copyleft licenses",severity:"ERROR",action:"DENY",enabled:!0},{name:"warn-unknown",description:"Warn on unknown licenses",severity:"WARNING",action:"WARN",enabled:!0}],allowedLicenses:["MIT","Apache-2.0","BSD-2-Clause","BSD-3-Clause","ISC"],deniedLicenses:["GPL-2.0-only","GPL-3.0-only","AGPL-3.0-only"],licenseCategories:[{name:"permissive",licenses:["MIT","Apache-2.0","BSD-2-Clause","BSD-3-Clause"]},{name:"copyleft",licenses:["GPL-2.0-only","GPL-3.0-only","LGPL-2.1-only"]}],exemptions:[],settings:{failOnError:!0,failOnWarning:!1,acceptAiSuggestions:!0,minimumConfidence:"MEDIUM"}};function L(o){var e;try{return((e=JSON.parse(o.config).rules)==null?void 0:e.length)||0}catch{return 0}}async function C(){b.value=!0;try{const o=await D.listPolicies(1,100);k.value=o.data.policies}catch(o){console.error("Failed to fetch policies",o),u.add({severity:"error",summary:"Error",detail:"Failed to fetch policies",life:3e3})}finally{b.value=!1}}function S(){c.value="";const o={...E,name:""};f.value=JSON.stringify(o,null,2),m.value=!1,d.value=!0}async function O(){if(!c.value.trim()){u.add({severity:"warn",summary:"Warning",detail:"Please enter a policy name",life:3e3});return}try{JSON.parse(f.value)}catch{u.add({severity:"error",summary:"Error",detail:"Invalid JSON configuration",life:3e3});return}v.value=!0;try{const o=JSON.parse(f.value);o.name=c.value,await D.createPolicy({name:c.value,config:JSON.stringify(o),isDefault:m.value}),u.add({severity:"success",summary:"Success",detail:"Policy created successfully",life:3e3}),d.value=!1,await C()}catch(o){console.error("Failed to create policy",o),u.add({severity:"error",summary:"Error",detail:"Failed to create policy",life:3e3})}finally{v.value=!1}}function I(o){A.push(`/policies/${o.id}`)}function R(o){y.value=o,p.value=!0}async function B(){if(y.value)try{await D.deletePolicy(y.value.id),u.add({severity:"success",summary:"Success",detail:"Policy deleted successfully",life:3e3}),p.value=!1,y.value=null,await C()}catch(o){console.error("Failed to delete policy",o),u.add({severity:"error",summary:"Error",detail:"Failed to delete policy",life:3e3})}}return M(C),(o,e)=>{const w=j("tooltip");return V(),T("div",Q,[i("header",X,[e[7]||(e[7]=i("div",null,[i("h1",null,"Policies"),i("p",{class:"subtitle"},"Manage license compliance policies for your projects")],-1)),s(t(r),{label:"Create Policy",icon:"pi pi-plus",onClick:S})]),i("div",Z,[s(t(Y),{value:k.value,loading:b.value,stripedRows:"",showGridlines:"",tableStyle:"min-width: 50rem",class:"p-datatable-sm"},{empty:a(()=>[i("div",ee,[e[8]||(e[8]=i("i",{class:"pi pi-shield"},null,-1)),e[9]||(e[9]=i("h3",null,"No policies found",-1)),e[10]||(e[10]=i("p",null,"Create your first policy to start managing license compliance.",-1)),s(t(r),{label:"Create Policy",icon:"pi pi-plus",onClick:S})])]),default:a(()=>[s(t(g),{field:"name",header:"Name",sortable:"",style:{"min-width":"200px"}},{body:a(({data:l})=>[i("div",le,[e[11]||(e[11]=i("i",{class:"pi pi-shield"},null,-1)),i("span",null,P(l.name),1),l.isDefault?(V(),U(t(h),{key:0,value:"Default",severity:"info"})):W("",!0)])]),_:1}),s(t(g),{header:"Rules",style:{width:"100px"}},{body:a(({data:l})=>[s(t(h),{value:L(l),severity:"secondary"},null,8,["value"])]),_:1}),s(t(g),{field:"createdAt",header:"Created",sortable:"",style:{width:"180px"}},{body:a(({data:l})=>[N(P(new Date(l.createdAt).toLocaleDateString()),1)]),_:1}),s(t(g),{header:"Actions",style:{width:"150px"}},{body:a(({data:l})=>[i("div",ie,[x(s(t(r),{icon:"pi pi-eye",severity:"secondary",text:"",rounded:"",onClick:G=>I(l)},null,8,["onClick"]),[[w,"View",void 0,{top:!0}]]),x(s(t(r),{icon:"pi pi-trash",severity:"danger",text:"",rounded:"",onClick:G=>R(l),disabled:l.isDefault},null,8,["onClick","disabled"]),[[w,"Delete",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"])]),s(t($),{visible:d.value,"onUpdate:visible":e[4]||(e[4]=l=>d.value=l),header:"Create Policy",modal:"",style:{width:"600px"},closable:!v.value},{footer:a(()=>[s(t(r),{label:"Cancel",severity:"secondary",onClick:e[3]||(e[3]=l=>d.value=!1),disabled:v.value},null,8,["disabled"]),s(t(r),{label:"Create",icon:"pi pi-check",onClick:O,loading:v.value},null,8,["loading"])]),default:a(()=>[i("div",te,[e[12]||(e[12]=i("label",{for:"policyName"},"Policy Name",-1)),s(t(q),{id:"policyName",modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=l=>c.value=l),placeholder:"Enter policy name",class:"w-full"},null,8,["modelValue"])]),i("div",oe,[e[13]||(e[13]=i("label",{for:"policyConfig"},"Configuration (JSON)",-1)),s(t(K),{id:"policyConfig",modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=l=>f.value=l),rows:"15",class:"w-full config-textarea",placeholder:"Enter policy configuration..."},null,8,["modelValue"])]),i("div",se,[s(t(H),{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=l=>m.value=l),inputId:"isDefault",binary:!0},null,8,["modelValue"]),e[14]||(e[14]=i("label",{for:"isDefault"},"Set as default policy",-1))])]),_:1},8,["visible","closable"]),s(t($),{visible:p.value,"onUpdate:visible":e[6]||(e[6]=l=>p.value=l),header:"Confirm Delete",modal:"",style:{width:"400px"}},{footer:a(()=>[s(t(r),{label:"Cancel",severity:"secondary",onClick:e[5]||(e[5]=l=>p.value=!1)}),s(t(r),{label:"Delete",severity:"danger",icon:"pi pi-trash",onClick:B})]),default:a(()=>{var l;return[i("div",ae,[e[17]||(e[17]=i("i",{class:"pi pi-exclamation-triangle"},null,-1)),i("p",null,[e[15]||(e[15]=N("Are you sure you want to delete the policy ",-1)),i("strong",null,P((l=y.value)==null?void 0:l.name),1),e[16]||(e[16]=N("?",-1))]),e[18]||(e[18]=i("p",{class:"warning-text"},"This action cannot be undone.",-1))])]}),_:1},8,["visible"])])}}}),ye=z(ne,[["__scopeId","data-v-c254e2c5"]]);export{ye as default};
