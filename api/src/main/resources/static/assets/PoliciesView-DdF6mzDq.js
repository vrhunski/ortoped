import{d as I,M as J,o as F,c as M,a as i,i as t,u as s,j as a,r as n,h as P,H as T,b as _,t as D,e as k,g as h,X as j,z as W,k as x,_ as H}from"./index-ClqzWbZM.js";import{a as r,c as q,d as g,s as L,e as z}from"./column.esm-BbqAx-_5.js";import{s as V}from"./dialog.esm-BHhxsqSj.js";import{s as X}from"./textarea.esm-l-9BGks3.js";import{d as Y}from"./virtualscroller.esm-DDzwZ8vW.js";const K={class:"policies-page"},Q={class:"page-header"},Z={class:"section"},ee={class:"empty-state"},le={class:"policy-name"},ie={class:"action-buttons"},se={class:"form-group"},oe={class:"form-group"},te={class:"form-group checkbox-group"},ae={class:"delete-confirm"},ne=I({__name:"PoliciesView",setup(re){const E=j(),c=J(),N=n([]),w=n(!0),d=n(!1),p=n(!1),y=n(null),u=n(""),f=n(""),m=n(!1),v=n(!1),$={version:"1.0",name:"",description:"Default policy that flags unknown licenses",categories:{permissive:{description:"Permissive open source licenses",licenses:["MIT","Apache-2.0","BSD-2-Clause","BSD-3-Clause","ISC","Unlicense","0BSD","CC0-1.0"]},copyleft:{description:"Strong copyleft licenses",licenses:["GPL-2.0-only","GPL-2.0-or-later","GPL-3.0-only","GPL-3.0-or-later","AGPL-3.0-only","AGPL-3.0-or-later"]},"copyleft-limited":{description:"Weak copyleft licenses with limited scope",licenses:["LGPL-2.0-only","LGPL-2.1-only","LGPL-3.0-only","MPL-2.0","EPL-1.0","EPL-2.0"]},unknown:{description:"Unknown or unresolved licenses",licenses:["NOASSERTION","Unknown"]}},rules:[{id:"no-unknown",name:"No Unknown Licenses",description:"All dependencies must have identified licenses",severity:"ERROR",enabled:!0,category:"unknown",action:"DENY",scopes:[],message:"Dependency {{dependency}} has unresolved license - manual review required"}],settings:{aiSuggestions:{acceptHighConfidence:!0,treatMediumAsWarning:!0,rejectLowConfidence:!0},failOn:{errors:!0,warnings:!1},exemptions:[]}};function O(o){var e;try{return((e=JSON.parse(o.config).rules)==null?void 0:e.length)||0}catch{return 0}}async function b(){w.value=!0;try{const o=await P.listPolicies(1,100);N.value=o.data.policies}catch(o){console.error("Failed to fetch policies",o),c.add({severity:"error",summary:"Error",detail:"Failed to fetch policies",life:3e3})}finally{w.value=!1}}function S(){u.value="";const o={...$,name:""};f.value=JSON.stringify(o,null,2),m.value=!1,d.value=!0}async function A(){if(!u.value.trim()){c.add({severity:"warn",summary:"Warning",detail:"Please enter a policy name",life:3e3});return}try{JSON.parse(f.value)}catch{c.add({severity:"error",summary:"Error",detail:"Invalid JSON configuration",life:3e3});return}v.value=!0;try{const o=JSON.parse(f.value);o.name=u.value,await P.createPolicy({name:u.value,config:JSON.stringify(o),isDefault:m.value}),c.add({severity:"success",summary:"Success",detail:"Policy created successfully",life:3e3}),d.value=!1,await b()}catch(o){console.error("Failed to create policy",o),c.add({severity:"error",summary:"Error",detail:"Failed to create policy",life:3e3})}finally{v.value=!1}}function G(o){E.push(`/policies/${o.id}`)}function U(o){y.value=o,p.value=!0}async function R(){if(y.value)try{await P.deletePolicy(y.value.id),c.add({severity:"success",summary:"Success",detail:"Policy deleted successfully",life:3e3}),p.value=!1,y.value=null,await b()}catch(o){console.error("Failed to delete policy",o),c.add({severity:"error",summary:"Error",detail:"Failed to delete policy",life:3e3})}}return F(b),(o,e)=>{const C=W("tooltip");return x(),M("div",K,[i("header",Q,[e[7]||(e[7]=i("div",null,[i("h1",null,"Policies"),i("p",{class:"subtitle"},"Manage license compliance policies for your projects")],-1)),t(s(r),{label:"Create Policy",icon:"pi pi-plus",onClick:S})]),i("div",Z,[t(s(q),{value:N.value,loading:w.value,stripedRows:"",showGridlines:"",tableStyle:"min-width: 50rem",class:"p-datatable-sm"},{empty:a(()=>[i("div",ee,[e[8]||(e[8]=i("i",{class:"pi pi-shield"},null,-1)),e[9]||(e[9]=i("h3",null,"No policies found",-1)),e[10]||(e[10]=i("p",null,"Create your first policy to start managing license compliance.",-1)),t(s(r),{label:"Create Policy",icon:"pi pi-plus",onClick:S})])]),default:a(()=>[t(s(g),{field:"name",header:"Name",sortable:"",style:{"min-width":"200px"}},{body:a(({data:l})=>[i("div",le,[e[11]||(e[11]=i("i",{class:"pi pi-shield"},null,-1)),i("span",null,D(l.name),1),l.isDefault?(x(),T(s(L),{key:0,value:"Default",severity:"info"})):_("",!0)])]),_:1}),t(s(g),{header:"Rules",style:{width:"100px"}},{body:a(({data:l})=>[t(s(L),{value:O(l),severity:"secondary"},null,8,["value"])]),_:1}),t(s(g),{field:"createdAt",header:"Created",sortable:"",style:{width:"180px"}},{body:a(({data:l})=>[k(D(new Date(l.createdAt).toLocaleDateString()),1)]),_:1}),t(s(g),{header:"Actions",style:{width:"150px"}},{body:a(({data:l})=>[i("div",ie,[h(t(s(r),{icon:"pi pi-eye",severity:"secondary",text:"",rounded:"",onClick:B=>G(l)},null,8,["onClick"]),[[C,"View",void 0,{top:!0}]]),h(t(s(r),{icon:"pi pi-trash",severity:"danger",text:"",rounded:"",onClick:B=>U(l),disabled:l.isDefault},null,8,["onClick","disabled"]),[[C,"Delete",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"])]),t(s(V),{visible:d.value,"onUpdate:visible":e[4]||(e[4]=l=>d.value=l),header:"Create Policy",modal:"",style:{width:"600px"},closable:!v.value},{footer:a(()=>[t(s(r),{label:"Cancel",severity:"secondary",onClick:e[3]||(e[3]=l=>d.value=!1),disabled:v.value},null,8,["disabled"]),t(s(r),{label:"Create",icon:"pi pi-check",onClick:A,loading:v.value},null,8,["loading"])]),default:a(()=>[i("div",se,[e[12]||(e[12]=i("label",{for:"policyName"},"Policy Name",-1)),t(s(z),{id:"policyName",modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=l=>u.value=l),placeholder:"Enter policy name",class:"w-full"},null,8,["modelValue"])]),i("div",oe,[e[13]||(e[13]=i("label",{for:"policyConfig"},"Configuration (JSON)",-1)),t(s(X),{id:"policyConfig",modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=l=>f.value=l),rows:"15",class:"w-full config-textarea",placeholder:"Enter policy configuration..."},null,8,["modelValue"])]),i("div",te,[t(s(Y),{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=l=>m.value=l),inputId:"isDefault",binary:!0},null,8,["modelValue"]),e[14]||(e[14]=i("label",{for:"isDefault"},"Set as default policy",-1))])]),_:1},8,["visible","closable"]),t(s(V),{visible:p.value,"onUpdate:visible":e[6]||(e[6]=l=>p.value=l),header:"Confirm Delete",modal:"",style:{width:"400px"}},{footer:a(()=>[t(s(r),{label:"Cancel",severity:"secondary",onClick:e[5]||(e[5]=l=>p.value=!1)}),t(s(r),{label:"Delete",severity:"danger",icon:"pi pi-trash",onClick:R})]),default:a(()=>{var l;return[i("div",ae,[e[17]||(e[17]=i("i",{class:"pi pi-exclamation-triangle"},null,-1)),i("p",null,[e[15]||(e[15]=k("Are you sure you want to delete the policy ",-1)),i("strong",null,D((l=y.value)==null?void 0:l.name),1),e[16]||(e[16]=k("?",-1))]),e[18]||(e[18]=i("p",{class:"warning-text"},"This action cannot be undone.",-1))])]}),_:1},8,["visible"])])}}}),fe=H(ne,[["__scopeId","data-v-d9a33c19"]]);export{fe as default};
