import{d as W,l as q,o as J,c,b as y,r as m,a as s,e as f,F as M,i as t,j as u,u as a,R as U,p as x,t as r,q as E,g as K,v as Q,h as S,s as X,x as O,k as d,_ as Y}from"./index-DzC_UEuu.js";import{s as B,a as k,b as Z,c as A,d as g}from"./column.esm-BfNXG1VX.js";const ee={class:"scan-detail"},se={key:0,class:"loading"},le={class:"page-header"},ae={class:"breadcrumb"},ie={class:"scan-meta"},ne={key:0,class:"header-actions"},te={key:0,class:"section scanning-state"},oe={key:1,class:"section error-state"},de={class:"compliance-icon"},re={class:"compliance-info"},ce={class:"compliance-stats"},ue={key:0,class:"stat"},pe={key:1,class:"stat"},ve={key:2,class:"stat"},ye={key:3,class:"stat"},ge={class:"section policy-section"},me={class:"policy-controls"},fe={class:"policy-selector"},he={key:0,class:"no-policies"},we={key:1,class:"section violations-section"},_e={class:"section-header"},ke={class:"dependency-name"},be={class:"license-badge"},Ce={class:"rule-name"},Se={class:"violation-message"},Re={key:0,class:"suggestion"},xe={class:"section"},De={class:"section-header"},Pe={class:"dep-id"},Le={class:"license-badge"},Ne={key:0,class:"ai-suggestion"},Fe={class:"suggested-license"},Ve={class:"reasoning"},Ie={key:1,class:"no-suggestion"},Me=W({__name:"ScanDetailView",setup(Ue){const D=X(),b=q(),p=m(null),N=m([]),P=m(!0),F=m(0),R=m(""),w=m([]),_=m(null),C=m(!1),i=m(null),V=E(()=>{let n=[...N.value];if(R.value){const e=R.value.toLowerCase();n=n.filter(l=>{var o;return l.name.toLowerCase().includes(e)||((o=l.concludedLicense)==null?void 0:o.toLowerCase().includes(e))})}return n.sort((e,l)=>!e.isResolved&&e.aiSuggestion&&(l.isResolved||!l.aiSuggestion)?-1:!l.isResolved&&l.aiSuggestion&&(e.isResolved||!e.aiSuggestion)?1:!e.isResolved&&l.isResolved?-1:!l.isResolved&&e.isResolved?1:e.name.localeCompare(l.name)),n}),$=E(()=>w.value.map(n=>({label:n.name+(n.isDefault?" (Default)":""),value:n.id})));async function j(){P.value=!0;try{const[n,e]=await Promise.all([S.getScan(D.params.id),S.listPolicies(1,100)]);p.value=n.data,w.value=e.data.policies;const l=w.value.find(o=>o.isDefault);if(l?_.value=l.id:w.value.length>0&&(_.value=w.value[0].id),p.value.status==="complete"){const o=[];let v=1;const h=100;let I=!0;for(;I;){const L=await S.getDependencies(D.params.id,v,h);o.push(...L.data.dependencies),F.value=L.data.total,o.length>=L.data.total?I=!1:v++}N.value=o}}catch(n){console.error("Failed to fetch scan data",n),b.add({severity:"error",summary:"Error",detail:"Failed to fetch scan data",life:3e3})}finally{P.value=!1}}async function G(){var n,e;if(!(!_.value||!p.value)){C.value=!0,i.value=null;try{const o=(await S.evaluatePolicy(p.value.id,_.value)).data,v=JSON.parse(o.report);i.value={policyId:o.policyId,policyName:v.policyName,scanId:o.scanId,passed:o.passed,errorCount:o.errorCount,warningCount:o.warningCount,infoCount:((n=v.summary)==null?void 0:n.infoCount)||0,violations:((e=v.violations)==null?void 0:e.map(h=>({severity:h.severity,rule:h.ruleName,message:h.message,dependency:h.dependencyName,license:h.license,suggestion:h.aiSuggestion})))||[],evaluatedAt:o.createdAt},i.value.passed?b.add({severity:"success",summary:"Policy Check Passed",detail:"No violations found",life:3e3}):b.add({severity:"warn",summary:"Policy Check Failed",detail:`Found ${i.value.errorCount} errors, ${i.value.warningCount} warnings`,life:5e3})}catch(l){console.error("Failed to evaluate policy",l),b.add({severity:"error",summary:"Error",detail:"Failed to run policy check",life:3e3})}finally{C.value=!1}}}async function z(n){try{const e=await S.generateSbom(D.params.id,n),l=new Blob([e.data.content],{type:"application/json"}),o=URL.createObjectURL(l),v=document.createElement("a");v.href=o,v.download=e.data.filename,v.click(),URL.revokeObjectURL(o)}catch(e){console.error("Failed to download SBOM",e),b.add({severity:"error",summary:"Error",detail:"Failed to download SBOM",life:3e3})}}function T(n){switch(n){case"HIGH":return"confidence-high";case"MEDIUM":return"confidence-medium";default:return"confidence-low"}}function H(n){switch(n){case"ERROR":return"danger";case"WARNING":return"warning";case"INFO":return"info";default:return"secondary"}}return J(j),(n,e)=>(d(),c("div",ee,[P.value?(d(),c("div",se,[...e[3]||(e[3]=[s("i",{class:"pi pi-spin pi-spinner"},null,-1),f(" Loading... ",-1)])])):p.value?(d(),c(M,{key:1},[s("header",le,[s("div",null,[s("div",ae,[t(a(U),{to:"/scans"},{default:u(()=>[...e[4]||(e[4]=[f("Scans",-1)])]),_:1}),e[5]||(e[5]=s("i",{class:"pi pi-angle-right"},null,-1)),e[6]||(e[6]=s("span",null,"Scan Details",-1))]),e[7]||(e[7]=s("h1",null,"Scan Details",-1)),s("div",ie,[s("span",{class:x(["status-badge",p.value.status==="complete"?"status-success":"status-warning"])},r(p.value.status),3),s("span",null,"Created: "+r(new Date(p.value.createdAt).toLocaleString()),1)])]),p.value.status==="complete"?(d(),c("div",ne,[t(a(B),{label:"Export SBOM",icon:"pi pi-download",severity:"secondary",onClick:e[0]||(e[0]=l=>z("cyclonedx-json"))})])):y("",!0)]),p.value.status==="scanning"?(d(),c("div",te,[...e[8]||(e[8]=[s("i",{class:"pi pi-spin pi-spinner"},null,-1),s("h3",null,"Scan in Progress",-1),s("p",null,"Analyzing dependencies and resolving licenses...",-1)])])):p.value.status==="failed"?(d(),c("div",oe,[e[9]||(e[9]=s("i",{class:"pi pi-times-circle"},null,-1)),e[10]||(e[10]=s("h3",null,"Scan Failed",-1)),s("p",null,r(p.value.errorMessage||"An unknown error occurred"),1)])):(d(),c(M,{key:2},[i.value?(d(),c("div",{key:0,class:x(["compliance-banner",i.value.passed?"compliance-passed":"compliance-failed"])},[s("div",de,[s("i",{class:x(i.value.passed?"pi pi-check-circle":"pi pi-times-circle")},null,2)]),s("div",re,[s("h3",null,r(i.value.passed?"Policy Check Passed":"Policy Check Failed"),1),s("p",null,"Policy: "+r(i.value.policyName),1)]),s("div",ce,[i.value.errorCount>0?(d(),c("div",ue,[t(a(k),{value:i.value.errorCount,severity:"danger"},null,8,["value"]),e[11]||(e[11]=s("span",null,"Errors",-1))])):y("",!0),i.value.warningCount>0?(d(),c("div",pe,[t(a(k),{value:i.value.warningCount,severity:"warning"},null,8,["value"]),e[12]||(e[12]=s("span",null,"Warnings",-1))])):y("",!0),i.value.infoCount>0?(d(),c("div",ve,[t(a(k),{value:i.value.infoCount,severity:"info"},null,8,["value"]),e[13]||(e[13]=s("span",null,"Info",-1))])):y("",!0),i.value.passed?(d(),c("div",ye,[t(a(k),{value:"0",severity:"success"}),e[14]||(e[14]=s("span",null,"Violations",-1))])):y("",!0)])],2)):y("",!0),s("div",ge,[e[19]||(e[19]=s("div",{class:"section-header"},[s("h2",null,[s("i",{class:"pi pi-shield"}),f(" Policy Compliance")])],-1)),s("div",me,[s("div",fe,[e[15]||(e[15]=s("label",null,"Select Policy:",-1)),t(a(Z),{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=l=>_.value=l),options:$.value,optionLabel:"label",optionValue:"value",placeholder:"Select a policy",class:"policy-dropdown",disabled:C.value||w.value.length===0},null,8,["modelValue","options","disabled"])]),t(a(B),{label:"Run Policy Check",icon:"pi pi-play",onClick:G,loading:C.value,disabled:!_.value||C.value},null,8,["loading","disabled"])]),w.value.length===0?(d(),c("p",he,[e[17]||(e[17]=f(" No policies available. ",-1)),t(a(U),{to:"/policies"},{default:u(()=>[...e[16]||(e[16]=[f("Create a policy",-1)])]),_:1}),e[18]||(e[18]=f(" to run compliance checks. ",-1))])):y("",!0)]),i.value&&i.value.violations.length>0?(d(),c("div",we,[s("div",_e,[s("h2",null,[e[20]||(e[20]=s("i",{class:"pi pi-exclamation-triangle"},null,-1)),f(" Violations ("+r(i.value.violations.length)+")",1)])]),t(a(A),{value:i.value.violations,stripedRows:"",showGridlines:"",class:"p-datatable-sm",paginator:i.value.violations.length>10,rows:10},{default:u(()=>[t(a(g),{field:"severity",header:"Severity",style:{width:"100px"},sortable:""},{body:u(({data:l})=>[t(a(k),{value:l.severity,severity:H(l.severity)},null,8,["value","severity"])]),_:1}),t(a(g),{field:"dependency",header:"Dependency",style:{"min-width":"200px"},sortable:""},{body:u(({data:l})=>[s("code",ke,r(l.dependency),1)]),_:1}),t(a(g),{field:"license",header:"License",style:{width:"150px"},sortable:""},{body:u(({data:l})=>[s("span",be,r(l.license||"Unknown"),1)]),_:1}),t(a(g),{field:"rule",header:"Rule",style:{width:"150px"},sortable:""},{body:u(({data:l})=>[s("span",Ce,r(l.rule),1)]),_:1}),t(a(g),{field:"message",header:"Message",style:{"min-width":"250px"}},{body:u(({data:l})=>[s("div",Se,[f(r(l.message)+" ",1),l.suggestion?(d(),c("div",Re,[e[21]||(e[21]=s("i",{class:"pi pi-lightbulb"},null,-1)),f(" "+r(l.suggestion),1)])):y("",!0)])]),_:1})]),_:1},8,["value","paginator"])])):y("",!0),s("div",xe,[s("div",De,[s("h2",null,"Dependencies ("+r(F.value)+")",1),K(s("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>R.value=l),type:"text",placeholder:"Filter dependencies...",class:"filter-input"},null,512),[[Q,R.value]])]),t(a(A),{value:V.value,stripedRows:"",showGridlines:"",class:"p-datatable-sm",paginator:V.value.length>20,rows:20},{default:u(()=>[t(a(g),{field:"name",header:"Package",style:{"min-width":"200px"},sortable:""},{body:u(({data:l})=>[s("div",null,[s("strong",null,r(l.name),1),s("div",Pe,r(l.id),1)])]),_:1}),t(a(g),{field:"version",header:"Version",style:{width:"120px"},sortable:""}),t(a(g),{header:"License",style:{width:"150px"}},{body:u(({data:l})=>[s("span",Le,r(l.concludedLicense||l.declaredLicenses[0]||"Unknown"),1)]),_:1}),t(a(g),{field:"isResolved",header:"Status",style:{width:"120px"}},{body:u(({data:l})=>[l.isResolved?(d(),O(a(k),{key:0,value:"Resolved",severity:"success"})):(d(),O(a(k),{key:1,value:"Unresolved",severity:"warning"}))]),_:1}),t(a(g),{header:"AI Suggestion",style:{"min-width":"200px"}},{body:u(({data:l})=>[l.aiSuggestion?(d(),c("div",Ne,[s("span",Fe,r(l.aiSuggestion.suggestedLicense),1),s("span",{class:x(["confidence",T(l.aiSuggestion.confidence)])},r(l.aiSuggestion.confidence),3),s("div",Ve,r(l.aiSuggestion.reasoning),1)])):(d(),c("span",Ie,"-"))]),_:1})]),_:1},8,["value","paginator"])])],64))],64)):y("",!0)]))}}),Be=Y(Me,[["__scopeId","data-v-59f7ae47"]]);export{Be as default};
