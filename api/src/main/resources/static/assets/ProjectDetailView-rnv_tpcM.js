import{d as T,l as O,m as z,o as X,n as J,c as i,b as y,r as g,a as e,e as u,F as L,i as c,j as N,u as p,R as U,t as o,p as D,q,f as G,h as m,s as H,k as r,_ as K}from"./index-D4N1nedD.js";import{s as w}from"./inputswitch.esm-Dm9KPrwt.js";const Y={class:"project-detail"},Q={key:0,class:"loading"},W={class:"page-header"},Z={class:"breadcrumb"},ee={class:"project-meta"},se={key:0},le={class:"section scan-config-section"},ae={class:"scan-config-panel"},ne={class:"config-row"},te={class:"config-row"},oe={class:"config-row"},ie={class:"scan-actions"},re=["disabled"],ue=["disabled"],de={class:"section"},ce={class:"section-header"},pe={key:0,class:"scanning-indicator"},fe={key:0,class:"empty-state"},ve={key:1,class:"data-table"},ge={key:0,class:"pi pi-spin pi-spinner status-spinner"},me={class:"duration-cell"},$="ortoped.scanConfig",Se=3e3,be=T({__name:"ProjectDetailView",setup(ye){const A=O(),_=H(),t=g(null),f=g([]),C=g(!0),d=g(!1),n=g({enableAi:!0,enableSpdx:!1,enableSourceScan:!1,parallelAiCalls:!0});let v=null;const h=q(()=>f.value.some(a=>a.status==="pending"||a.status==="scanning"));function x(){const a=localStorage.getItem($);if(a)try{n.value={...n.value,...JSON.parse(a)}}catch{console.warn("Failed to parse saved scan config")}}function F(){localStorage.setItem($,JSON.stringify(n.value))}function M(a,s){if(!a)return"-";const l=new Date(a).getTime(),P=(s?new Date(s).getTime():Date.now())-l;if(P<0)return"-";const S=Math.floor(P/1e3),b=Math.floor(S/60),R=Math.floor(b/60);return R>0?`${R}h ${b%60}m ${S%60}s`:b>0?`${b}m ${S%60}s`:`${S}s`}async function B(){C.value=!0;try{const[a,s]=await Promise.all([m.getProject(_.params.id),m.listScans({projectId:_.params.id,pageSize:20})]);t.value=a.data,f.value=s.data.scans}catch(a){console.error("Failed to fetch project data",a)}finally{C.value=!1}}async function j(){if(t.value)try{const a=await m.listScans({projectId:t.value.id,pageSize:20});f.value=a.data.scans}catch(a){console.error("Failed to refresh scans",a)}}function k(){v||(v=window.setInterval(async()=>{if(!h.value){V();return}await j()},Se))}function V(){v&&(clearInterval(v),v=null)}async function I(a=!1){if(t.value){d.value=!0,F();try{if(a)await m.triggerScan({projectId:t.value.id,enableAi:!0,enableSourceScan:!1,parallelAiCalls:!0,demoMode:!0}),A.add({severity:"success",summary:"Demo Scan Started",detail:"Demo scan started with default settings",life:3e3});else{await m.triggerScan({projectId:t.value.id,enableAi:n.value.enableAi,enableSourceScan:n.value.enableSourceScan,parallelAiCalls:n.value.parallelAiCalls,demoMode:!1});const s=[n.value.enableAi?"AI":null,n.value.enableSourceScan?"Source Scan":null,n.value.parallelAiCalls&&n.value.enableAi?"Parallel":null].filter(Boolean).join(", ");A.add({severity:"success",summary:"Scan Started",detail:s?`Scan started with: ${s}`:"Scan started",life:3e3})}await j(),k()}catch(s){console.error("Failed to trigger scan",s),A.add({severity:"error",summary:"Scan Failed",detail:"Failed to start scan",life:5e3})}finally{d.value=!1}}}function E(a){switch(a){case"complete":return"status-success";case"scanning":return"status-warning";case"failed":return"status-error";default:return"status-pending"}}return z(h,a=>{a?k():V()}),X(()=>{x(),B()}),J(()=>{V()}),(a,s)=>(r(),i("div",Y,[C.value?(r(),i("div",Q,[...s[6]||(s[6]=[e("i",{class:"pi pi-spin pi-spinner"},null,-1),u(" Loading... ",-1)])])):t.value?(r(),i(L,{key:1},[e("header",W,[e("div",null,[e("div",Z,[c(p(U),{to:"/projects"},{default:N(()=>[...s[7]||(s[7]=[u("Projects",-1)])]),_:1}),s[8]||(s[8]=e("i",{class:"pi pi-angle-right"},null,-1)),e("span",null,o(t.value.name),1)]),e("h1",null,o(t.value.name),1),e("div",ee,[t.value.repositoryUrl?(r(),i("span",se,[s[9]||(s[9]=e("i",{class:"pi pi-github"},null,-1)),u(" "+o(t.value.repositoryUrl),1)])):y("",!0),e("span",null,[s[10]||(s[10]=e("i",{class:"pi pi-code-branch"},null,-1)),u(" "+o(t.value.defaultBranch),1)])])])]),e("div",le,[s[16]||(s[16]=e("h2",null,"Scan Configuration",-1)),e("div",ae,[e("div",ne,[s[11]||(s[11]=e("div",{class:"config-info"},[e("span",{class:"config-label"},"Enable AI Analysis"),e("span",{class:"config-description"},"Use Claude to resolve unknown licenses")],-1)),c(p(w),{modelValue:n.value.enableAi,"onUpdate:modelValue":s[0]||(s[0]=l=>n.value.enableAi=l)},null,8,["modelValue"])]),e("div",te,[s[12]||(s[12]=e("div",{class:"config-info"},[e("span",{class:"config-label"},"Enable SPDX Validation"),e("span",{class:"config-description"},"Validate licenses against SPDX database")],-1)),c(p(w),{modelValue:n.value.enableSpdx,"onUpdate:modelValue":s[1]||(s[1]=l=>n.value.enableSpdx=l)},null,8,["modelValue"])]),e("div",oe,[s[13]||(s[13]=e("div",{class:"config-info"},[e("span",{class:"config-label"},"Source Code Scan"),e("span",{class:"config-description"},"Deep scan with ScanCode (slower)")],-1)),c(p(w),{modelValue:n.value.enableSourceScan,"onUpdate:modelValue":s[2]||(s[2]=l=>n.value.enableSourceScan=l)},null,8,["modelValue"])]),e("div",{class:D(["config-row",{disabled:!n.value.enableAi}])},[s[14]||(s[14]=e("div",{class:"config-info"},[e("span",{class:"config-label"},"Parallel AI Processing"),e("span",{class:"config-description"},"Process packages concurrently")],-1)),c(p(w),{modelValue:n.value.parallelAiCalls,"onUpdate:modelValue":s[3]||(s[3]=l=>n.value.parallelAiCalls=l),disabled:!n.value.enableAi},null,8,["modelValue","disabled"])],2)]),e("div",ie,[e("button",{class:"btn btn-secondary",onClick:s[4]||(s[4]=l=>I(!0)),disabled:d.value},[...s[15]||(s[15]=[e("i",{class:"pi pi-play"},null,-1),u(" Demo Scan ",-1)])],8,re),e("button",{class:"btn btn-primary",onClick:s[5]||(s[5]=l=>I(!1)),disabled:d.value||!t.value.repositoryUrl},[e("i",{class:D(["pi pi-refresh",{"pi-spin":d.value}])},null,2),u(" "+o(d.value?"Starting...":"Run Scan"),1)],8,ue)])]),e("div",de,[e("div",ce,[s[18]||(s[18]=e("h2",null,"Scan History",-1)),h.value?(r(),i("span",pe,[...s[17]||(s[17]=[e("i",{class:"pi pi-spin pi-spinner"},null,-1),u(" Scanning... ",-1)])])):y("",!0)]),f.value.length===0?(r(),i("div",fe,[...s[19]||(s[19]=[e("p",null,"No scans yet. Run your first scan to see results here.",-1)])])):(r(),i("table",ve,[s[21]||(s[21]=e("thead",null,[e("tr",null,[e("th",null,"Status"),e("th",null,"Dependencies"),e("th",null,"Resolved"),e("th",null,"Unresolved"),e("th",null,"AI Resolved"),e("th",null,"SPDX Resolved"),e("th",null,"Duration"),e("th",null,"Completed"),e("th")])],-1)),e("tbody",null,[(r(!0),i(L,null,G(f.value,l=>(r(),i("tr",{key:l.id},[e("td",null,[e("span",{class:D(["status-badge",E(l.status)])},[l.status==="scanning"?(r(),i("i",ge)):y("",!0),u(" "+o(l.status),1)],2)]),e("td",null,o(l.totalDependencies),1),e("td",null,o(l.resolvedLicenses),1),e("td",null,o(l.unresolvedLicenses),1),e("td",null,o(l.aiResolvedLicenses),1),e("td",null,o(l.spdxResolvedLicenses||0),1),e("td",me,o(M(l.startedAt,l.completedAt)),1),e("td",null,o(l.completedAt?new Date(l.completedAt).toLocaleString():"-"),1),e("td",null,[c(p(U),{to:`/scans/${l.id}`,class:"btn btn-small"},{default:N(()=>[...s[20]||(s[20]=[u(" View ",-1)])]),_:1},8,["to"])])]))),128))])]))])],64)):y("",!0)]))}}),he=K(be,[["__scopeId","data-v-1b72070f"]]);export{he as default};
