# Analyzer Configuration

This document describes the ORT Analyzer Configuration feature that allows users to customize how the OSS Review Toolkit (ORT) analyzer scans their projects.

## Overview

The Analyzer Configuration UI provides fine-grained control over ORT's dependency analysis behavior. Users can configure settings per project through the web dashboard and export configurations for CLI usage.

## Features

### 1. Allow Dynamic Versions

**Default:** `true`

When enabled, ORT will analyze projects that use version ranges (e.g., `^1.0.0`, `~2.3.0`, `>=1.0.0`) even without lockfiles present.

**Use cases:**
- Projects without lockfiles (e.g., no `package-lock.json`, `yarn.lock`)
- Development environments where exact versions aren't pinned
- Quick scans where lockfile generation isn't practical

**Disable when:**
- You need reproducible builds with exact versions
- Compliance requirements mandate version pinning
- You want to enforce lockfile usage

### 2. Skip Excluded Dependencies

**Default:** `true`

When enabled, ORT will skip dependencies that are marked as excluded in the project's `.ort.yml` configuration file.

**Use cases:**
- Excluding test dependencies from compliance checks
- Skipping internal/private packages
- Ignoring dependencies that have already been reviewed

### 3. Disabled Package Managers

Select which package managers to exclude from analysis. This is useful when:
- A package manager's tooling isn't installed on the system
- You want to focus on specific ecosystems
- Certain package managers cause issues with your project

#### Available Package Managers

| Category | Package Managers |
|----------|-----------------|
| **JVM** | Maven, Gradle, SBT |
| **JavaScript** | NPM, Yarn, PNPM, Bower |
| **Python** | Pip, Poetry, Pipenv |
| **Rust** | Cargo |
| **Go** | GoMod |
| **.NET** | NuGet |
| **iOS/macOS** | CocoaPods, SwiftPM |
| **PHP** | Composer |
| **Ruby** | Bundler |
| **Dart** | Pub |
| **C/C++** | Conan |

## UI Location

The Analyzer Configuration panel is located on the **Project Detail** page, below the Scan Configuration section. Click on "Analyzer Configuration" to expand the panel.

## Configuration Persistence

- Settings are saved to browser localStorage
- Settings persist across browser sessions
- Each project uses the same global analyzer configuration
- Settings are applied when triggering a new scan

## ORT Config Export

After configuring the analyzer settings, you can download an `ort-config.yml` file by clicking the **"Download ORT Config"** button. This file can be used with:

### OrtoPed CLI

```bash
# Set the config directory
export ORT_CONFIG_DIR=/path/to/config

# Run scan
ortoped scan --project /path/to/project
```

### ORT CLI

```bash
# Run analyzer with config
ort analyze -i /path/to/project -o /path/to/output -c /path/to/ort-config.yml
```

### Generated Config Format

```yaml
# ORT Analyzer Configuration
# Generated by OrtoPed - https://github.com/ortoped
# Place this file in your ORT_CONFIG_DIR directory

ort:
  analyzer:
    allowDynamicVersions: true
    skipExcluded: true
    disabledPackageManagers:
      - Bower
      - NPM

# Usage:
# 1. Set ORT_CONFIG_DIR environment variable to the directory containing this file
# 2. Run: ort analyze -i <project-dir> -o <output-dir>
# Or with ortoped CLI:
# ortoped scan --project <project-dir>
```

## API Endpoints

### Get Available Package Managers

```http
GET /api/v1/scans/package-managers
```

**Response:**
```json
{
  "packageManagers": [
    {
      "name": "Maven",
      "displayName": "Maven",
      "description": "Java/Kotlin dependency management via pom.xml",
      "filePatterns": ["pom.xml"],
      "category": "JVM"
    }
  ],
  "categories": ["JVM", "JavaScript", "Python", ...]
}
```

### Generate ORT Config

```http
POST /api/v1/scans/ort-config
Content-Type: application/json

{
  "allowDynamicVersions": true,
  "skipExcluded": true,
  "disabledPackageManagers": ["Bower", "NPM"]
}
```

**Response:**
```json
{
  "configYml": "ort:\n  analyzer:\n    allowDynamicVersions: true\n...",
  "filename": "ort-config.yml"
}
```

### Trigger Scan with Analyzer Config

```http
POST /api/v1/scans
Content-Type: application/json

{
  "projectId": "uuid",
  "enableAi": true,
  "enableSpdx": false,
  "enableSourceScan": false,
  "parallelAiCalls": true,
  "allowDynamicVersions": true,
  "skipExcluded": true,
  "disabledPackageManagers": ["Bower"]
}
```

## Troubleshooting

### "Cannot run program X: No such file or directory"

This error occurs when ORT tries to use a package manager that isn't installed on the system. **Solution:** Disable the package manager in the Analyzer Configuration UI before running the scan.

Common package managers that may not be installed:
- **Bower** - Deprecated, rarely installed on modern systems
- **CocoaPods** - Only available on macOS
- **Cargo** - Only if Rust isn't installed

### Scan takes too long

If scans are taking too long, consider:
1. Disabling package managers you don't need
2. Enabling "Skip Excluded Dependencies" if you have an `.ort.yml` file

### Version conflicts

If you're getting inconsistent results due to version ranges:
1. Disable "Allow Dynamic Versions"
2. Ensure your project has proper lockfiles

## Related Documentation

- [ORT Documentation](https://oss-review-toolkit.org/ort/docs/getting-started/usage)
- [ORT Repository Configuration (.ort.yml)](https://oss-review-toolkit.org/ort/docs/configuration/ort-yml)
- [Scan Configuration](./QUICKSTART.md)
